# üìÅ cars/models.py - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
# üöó Proxy-–º–æ–¥–µ–ª–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º–∏
# üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò–º–ø–æ—Ä—Ç products.models ‚Üí references.models

from django.db import models
from references.models import Product, Category  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: products ‚Üí references

# --- –ú–µ–Ω–µ–¥–∂–µ—Ä—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ ---

class CarCategoryManager(models.Manager):
    """
    üöó –ú–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π.
    ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º category_type='cars' –≤–º–µ—Å—Ç–æ type='auto'
    """
    def get_queryset(self):
        return super().get_queryset().filter(category_type='cars')

class CarProductManager(models.Manager):
    """
    üöó –ú–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤-–∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π.
    ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
    """
    def get_queryset(self):
        # –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
        return super().get_queryset().filter(category__category_type='cars')

# --- Proxy-–º–æ–¥–µ–ª–∏ ---

class CarCategory(Category):
    """
    üöó Proxy-–º–æ–¥–µ–ª—å –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π.
    –ù–µ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É –≤ –ë–î, –∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –º–æ–¥–µ–ª–∏ Category, –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ —Ç–∏–ø—É 'cars'.
    """
    objects = CarCategoryManager()

    def save(self, *args, **kwargs):
        """üîí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∏–ø 'cars' –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏"""
        self.category_type = 'cars'
        super().save(*args, **kwargs)

    class Meta:
        proxy = True
        verbose_name = 'üöó –ö–∞—Ç–µ–≥–æ—Ä–∏—è –∞–≤—Ç–æ'
        verbose_name_plural = 'üöó –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∞–≤—Ç–æ'

class CarProduct(Product):
    """
    üöó Proxy-–º–æ–¥–µ–ª—å –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤-–∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π.
    –ù–µ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É –≤ –ë–î, –∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –º–æ–¥–µ–ª–∏ Product, –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π.
    """
    objects = CarProductManager()

    def save(self, *args, **kwargs):
        """
        üîí –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–æ–≤–∞—Ä –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∞–≤—Ç–æ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
        """
        if self.category and self.category.category_type != 'cars':
            raise ValueError("–¢–æ–≤–∞—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω —Ç–æ–ª—å–∫–æ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π")
        super().save(*args, **kwargs)

    class Meta:
        proxy = True
        verbose_name = 'üöó –¢–æ–≤–∞—Ä (–∞–≤—Ç–æ)'
        verbose_name_plural = 'üöó –¢–æ–≤–∞—Ä—ã (–∞–≤—Ç–æ)'