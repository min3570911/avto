<!-- üìÅ templates/admin/products/import_preview.html -->
<!-- üëÅÔ∏è –§–ò–ù–ê–õ–¨–ù–´–ô –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö –∏–º–ø–æ—Ä—Ç–∞ —Å –ø—Ä–æ—Å—Ç—ã–º–∏ URL -->

{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–º–ø–æ—Ä—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤{% endblock %}

{% block extrahead %}
{{ block.super }}
<style>
.preview-container {
    max-width: 1200px;
    margin: 20px auto;
    padding: 20px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.stat-card {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    border-left: 4px solid #007cba;
}

.stat-number {
    font-size: 24px;
    font-weight: bold;
    color: #007cba;
}

.stat-label {
    color: #666;
    font-size: 14px;
}

.data-section {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin: 20px 0;
    overflow: hidden;
}

.data-header {
    background: #007cba;
    color: white;
    padding: 15px 20px;
    font-weight: bold;
}

.data-content {
    padding: 20px;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0;
}

.data-table th, .data-table td {
    padding: 8px 12px;
    border: 1px solid #ddd;
    text-align: left;
    font-size: 13px;
}

.data-table th {
    background: #f5f5f5;
    font-weight: bold;
}

.data-table td {
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.btn-confirm {
    background: #28a745;
    color: white;
    padding: 12px 30px;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
    margin-right: 10px;
}

.btn-cancel {
    background: #6c757d;
    color: white;
    padding: 12px 30px;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
}

.btn-confirm:hover { background: #218838; }
.btn-cancel:hover { background: #545b62; text-decoration: none; color: white; }

.error-section {
    background: #fff5f5;
    border: 1px solid #fed7d7;
    border-radius: 8px;
    padding: 15px;
    margin: 20px 0;
}

.error-title {
    color: #c53030;
    font-weight: bold;
    margin-bottom: 10px;
}

.file-info {
    background: #e3f2fd;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
}
</style>
{% endblock %}

{% block content %}
<div class="preview-container">
    <h1>üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–º–ø–æ—Ä—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤</h1>
    
    <!-- üìÅ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ -->
    <div class="file-info">
        <h3>üìÅ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ:</h3>
        <p><strong>–§–∞–π–ª:</strong> {{ file_name }}</p>
        <p><strong>–†–∞–∑–º–µ—Ä:</strong> {{ file_size|filesizeformat }}</p>
        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω</p>
    </div>
    
    <!-- üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="data-section">
        <div class="data-header">üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
        <div class="data-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">{{ statistics.total_rows }}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ statistics.categories_count }}</div>
                    <div class="stat-label">üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ statistics.products_count }}</div>
                    <div class="stat-label">üõçÔ∏è –¢–æ–≤–∞—Ä–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ statistics.invalid_rows }}</div>
                    <div class="stat-label">‚ùå –û—à–∏–±–æ–∫</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ statistics.products_with_images }}</div>
                    <div class="stat-label">üñºÔ∏è –° –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ statistics.products_with_prices }}</div>
                    <div class="stat-label">üí∞ –° —Ü–µ–Ω–∞–º–∏</div>
                </div>
            </div>
            
            {% if statistics.category_names %}
            <div style="margin-top: 15px;">
                <strong>üìÇ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:</strong>
                <p style="color: #007cba;">{{ statistics.category_names|join:", " }}</p>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- üìÇ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
    {% if categories %}
    <div class="data-section">
        <div class="data-header">üìÇ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π ({{ total_categories }} –≤—Å–µ–≥–æ, –ø–æ–∫–∞–∑–∞–Ω–æ {{ categories|length }})</div>
        <div class="data-content">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                        <th>Title</th>
                        <th>Meta-–æ–ø–∏—Å–∞–Ω–∏–µ</th>
                        <th>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</th>
                        <th>–°—Ç—Ä–æ–∫–∞</th>
                    </tr>
                </thead>
                <tbody>
                    {% for category in categories %}
                    <tr>
                        <td><strong>{{ category.category_name }}</strong></td>
                        <td title="{{ category.name }}">{{ category.name|truncatechars:30 }}</td>
                        <td title="{{ category.title }}">{{ category.title|truncatechars:25 }}</td>
                        <td title="{{ category.meta_description }}">{{ category.meta_description|truncatechars:30 }}</td>
                        <td>{{ category.image|default:"‚Äî" }}</td>
                        <td>{{ category.row_number }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            {% if total_categories > categories|length %}
            <p style="color: #666; font-style: italic;">
                ... –∏ –µ—â—ë {{ total_categories|add:categories|length|add:"-"|add:categories|length }} –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            </p>
            {% endif %}
        </div>
    </div>
    {% endif %}
    
    <!-- üõçÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–æ–≤ -->
    {% if products %}
    <div class="data-section">
        <div class="data-header">üõçÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–æ–≤ ({{ total_products }} –≤—Å–µ–≥–æ, –ø–æ–∫–∞–∑–∞–Ω–æ {{ products|length }})</div>
        <div class="data-content">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>SKU</th>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                        <th>–¶–µ–Ω–∞</th>
                        <th>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</th>
                        <th>–°—Ç—Ä–æ–∫–∞</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products %}
                    <tr>
                        <td><strong>{{ product.sku }}</strong></td>
                        <td title="{{ product.name }}">{{ product.name|truncatechars:40 }}</td>
                        <td><span style="background: #e3f2fd; padding: 2px 6px; border-radius: 3px;">{{ product.category_name }}</span></td>
                        <td>
                            {% if product.price > 0 %}
                                <strong>{{ product.price }} —Ä—É–±.</strong>
                            {% else %}
                                <span style="color: #999;">–ù–µ —É–∫–∞–∑–∞–Ω–∞</span>
                            {% endif %}
                        </td>
                        <td>{{ product.image|default:"‚Äî" }}</td>
                        <td>{{ product.row_number }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            {% if total_products > products|length %}
            <p style="color: #666; font-style: italic;">
                ... –∏ –µ—â—ë {{ total_products|add:products|length|add:"-"|add:products|length }} —Ç–æ–≤–∞—Ä–æ–≤
            </p>
            {% endif %}
        </div>
    </div>
    {% endif %}
    
    <!-- ‚ùå –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ -->
    {% if invalid_data %}
    <div class="error-section">
        <div class="error-title">‚ùå –ù–∞–π–¥–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ –¥–∞–Ω–Ω—ã—Ö ({{ total_invalid }} —Å—Ç—Ä–æ–∫)</div>
        
        <table class="data-table">
            <thead>
                <tr>
                    <th>–°—Ç—Ä–æ–∫–∞</th>
                    <th>–î–∞–Ω–Ω—ã–µ</th>
                    <th>–û—à–∏–±–∫–∏</th>
                </tr>
            </thead>
            <tbody>
                {% for invalid in invalid_data %}
                <tr>
                    <td>{{ invalid.row_number }}</td>
                    <td>{{ invalid.identifier|default:"‚Äî" }} | {{ invalid.name|default:"‚Äî"|truncatechars:30 }}</td>
                    <td style="color: #c53030;">
                        {% for error in invalid.errors %}
                            <div>‚Ä¢ {{ error }}</div>
                        {% endfor %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        {% if total_invalid > invalid_data|length %}
        <p style="color: #666; font-style: italic; margin-top: 10px;">
            ... –∏ –µ—â—ë {{ total_invalid|add:invalid_data|length|add:"-"|add:invalid_data|length }} –æ—à–∏–±–æ–∫
        </p>
        {% endif %}
        
        <p style="margin-top: 15px; color: #c53030;">
            <strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:</strong> –°—Ç—Ä–æ–∫–∏ —Å –æ—à–∏–±–∫–∞–º–∏ –±—É–¥—É—Ç –ø—Ä–æ–ø—É—â–µ–Ω—ã –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ.
        </p>
    </div>
    {% endif %}
    
    <!-- üéØ –ß—Ç–æ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å -->
    <div class="data-section">
        <div class="data-header">üéØ –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ</div>
        <div class="data-content">
            <ol>
                <li><strong>üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏:</strong> –ë—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã {{ statistics.categories_count }} –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã, –µ—Å–ª–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç)</li>
                <li><strong>üõçÔ∏è –¢–æ–≤–∞—Ä—ã:</strong> –ë—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã/–æ–±–Ω–æ–≤–ª–µ–Ω—ã {{ statistics.products_count }} —Ç–æ–≤–∞—Ä–æ–≤ —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</li>
                <li><strong>üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</strong> –ë—É–¥—É—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã {{ statistics.products_with_images|add:statistics.categories_with_images }} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</li>
                <li><strong>üí∞ –¶–µ–Ω—ã:</strong> {{ statistics.products_with_prices }} —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–ª—É—á–∞—Ç —Ü–µ–Ω—ã, –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî 0.00 —Ä—É–±.</li>
                {% if invalid_data %}
                <li><strong>‚ùå –û—à–∏–±–∫–∏:</strong> {{ total_invalid }} —Å—Ç—Ä–æ–∫ –±—É–¥—É—Ç –ø—Ä–æ–ø—É—â–µ–Ω—ã –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏</li>
                {% endif %}
            </ol>
            
            <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-top: 15px; border-left: 4px solid #ffc107;">
                <strong>üí° –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç, –æ–Ω–∏ –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ —Ñ–∞–π–ª–∞.
            </div>
        </div>
    </div>
    
    <!-- üöÄ –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π - –ü–†–û–°–¢–´–ï URL -->
    <div style="text-align: center; margin: 30px 0;">
        {% if statistics.categories_count > 0 or statistics.products_count > 0 %}
        <form method="post" action="{% url 'import_execute' %}" style="display: inline;">
            {% csrf_token %}
            <input type="hidden" name="confirm_import" value="1">
            <button type="submit" class="btn-confirm">
                üöÄ –í—ã–ø–æ–ª–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç ({{ statistics.categories_count|add:statistics.products_count }} –∑–∞–ø–∏—Å–µ–π)
            </button>
        </form>
        {% endif %}
        
        <a href="{% url 'import_form' %}" class="btn-cancel">
            ‚Üê –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª
        </a>
    </div>
    
    <!-- üîô –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div style="text-align: center; margin-top: 30px;">
        <a href="{% url 'admin:products_product_changelist' %}" style="color: #007cba; text-decoration: none;">
            ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É —Ç–æ–≤–∞—Ä–æ–≤
        </a>
    </div>
</div>
{% endblock %}