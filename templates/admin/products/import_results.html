<!-- üìÅ templates/admin/products/import_results.html -->
<!-- üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–º–ø–æ—Ä—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
<!-- ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–±—Ä–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –ø–æ–ª—é 'code' -->

{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–º–ø–æ—Ä—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤{% endblock %}

{% block extrahead %}
{{ block.super }}
<style>
.results-container {
    max-width: 1200px;
    margin: 20px auto;
    padding: 20px;
}

.success-header {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    margin-bottom: 20px;
}

.error-header {
    background: linear-gradient(135deg, #dc3545, #fd7e14);
    color: white;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    margin-bottom: 20px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.stat-card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border-left: 4px solid #007cba;
}

.stat-number {
    font-size: 28px;
    font-weight: bold;
    color: #007cba;
}

.stat-label {
    color: #666;
    font-size: 14px;
    margin-top: 5px;
}

.section {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin: 20px 0;
    overflow: hidden;
}

.section-header {
    background: #f8f9fa;
    padding: 15px 20px;
    border-bottom: 1px solid #dee2e6;
    font-weight: bold;
    color: #495057;
}

.section-content {
    padding: 20px;
}

.results-table {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0;
}

.results-table th, .results-table td {
    padding: 8px 12px;
    border: 1px solid #ddd;
    text-align: left;
    font-size: 13px;
}

.results-table th {
    background: #f5f5f5;
    font-weight: bold;
}

.status-created {
    background: #d4edda;
    color: #155724;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 12px;
}

.status-updated {
    background: #fff3cd;
    color: #856404;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 12px;
}

.status-error {
    background: #f8d7da;
    color: #721c24;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 12px;
}

.btn-primary {
    background: #007cba;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    text-decoration: none;
    display: inline-block;
    margin: 10px 5px;
}

.btn-secondary {
    background: #6c757d;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    text-decoration: none;
    display: inline-block;
    margin: 10px 5px;
}

.btn-primary:hover { background: #005a87; color: white; text-decoration: none; }
.btn-secondary:hover { background: #545b62; color: white; text-decoration: none; }

.error-list {
    background: #fff5f5;
    border: 1px solid #fed7d7;
    border-radius: 8px;
    padding: 15px;
    margin: 15px 0;
}

.error-item {
    color: #c53030;
    margin: 5px 0;
    padding: 5px;
    border-left: 3px solid #c53030;
    padding-left: 10px;
}
</style>
{% endblock %}

{% block content %}
<div class="results-container">
    <!-- üìà –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    {% if results.success %}
    <div class="success-header">
        <h1>‚úÖ –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ!</h1>
        <p>–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö</p>
    </div>
    {% else %}
    <div class="error-header">
        <h1>‚ùå –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω —Å –æ—à–∏–±–∫–∞–º–∏</h1>
        <p>{{ results.error|default:"–ü—Ä–æ–∏–∑–æ—à–ª–∏ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö" }}</p>
    </div>
    {% endif %}
    
    <!-- üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="section">
        <div class="section-header">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–º–ø–æ—Ä—Ç–∞</div>
        <div class="section-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">{{ statistics.total_processed|default:0 }}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ statistics.categories_created|default:0 }}</div>
                    <div class="stat-label">üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–π —Å–æ–∑–¥–∞–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ statistics.categories_updated|default:0 }}</div>
                    <div class="stat-label">üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ statistics.products_created|default:0 }}</div>
                    <div class="stat-label">üõçÔ∏è –¢–æ–≤–∞—Ä–æ–≤ —Å–æ–∑–¥–∞–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ statistics.products_updated|default:0 }}</div>
                    <div class="stat-label">üõçÔ∏è –¢–æ–≤–∞—Ä–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ statistics.images_processed|default:0 }}</div>
                    <div class="stat-label">üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ statistics.errors|default:0 }}</div>
                    <div class="stat-label">‚ùå –û—à–∏–±–æ–∫</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- üìÇ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
    {% if results.category_results %}
    <div class="section">
        <div class="section-header">üìÇ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–º–ø–æ—Ä—Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</div>
        <div class="section-content">
            <table class="results-table">
                <thead>
                    <tr>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–°–æ–æ–±—â–µ–Ω–∏–µ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for result in results.category_results %}
                    <tr>
                        <td><strong>{{ result.name }}</strong></td>
                        <td>
                            {% if result.status == 'created' %}
                                <span class="status-created">‚úÖ –°–æ–∑–¥–∞–Ω–∞</span>
                            {% elif result.status == 'updated' %}
                                <span class="status-updated">üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∞</span>
                            {% else %}
                                <span class="status-error">‚ùå –û—à–∏–±–∫–∞</span>
                            {% endif %}
                        </td>
                        <td>{{ result.message }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
    
    <!-- üõçÔ∏è –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–æ–≤–∞—Ä–æ–≤ -->
    {% if results.product_results %}
    <div class="section">
        <div class="section-header">üõçÔ∏è –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–º–ø–æ—Ä—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤</div>
        <div class="section-content">
            <table class="results-table">
                <thead>
                    <tr>
                        <th>SKU</th>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–°–æ–æ–±—â–µ–Ω–∏–µ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for result in results.product_results %}
                    <tr>
                        <!-- üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–±—Ä–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É 'code' -->
                        <td><strong>{{ result.sku|default:"‚Äî" }}</strong></td>
                        <td>{{ result.name|truncatechars:50 }}</td>
                        <td>
                            {% if result.status == 'created' %}
                                <span class="status-created">‚úÖ –°–æ–∑–¥–∞–Ω</span>
                            {% elif result.status == 'updated' %}
                                <span class="status-updated">üîÑ –û–±–Ω–æ–≤–ª—ë–Ω</span>
                            {% else %}
                                <span class="status-error">‚ùå –û—à–∏–±–∫–∞</span>
                            {% endif %}
                        </td>
                        <td>{{ result.message }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
    
    <!-- ‚ùå –û—à–∏–±–∫–∏ -->
    {% if errors %}
    <div class="section">
        <div class="section-header">‚ùå –û—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞</div>
        <div class="section-content">
            <div class="error-list">
                {% for error in errors %}
                    <div class="error-item">{{ error }}</div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- üö´ –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
    {% if invalid_data %}
    <div class="section">
        <div class="section-header">üö´ –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ({{ invalid_data|length }} —Å—Ç—Ä–æ–∫)</div>
        <div class="section-content">
            <table class="results-table">
                <thead>
                    <tr>
                        <th>–°—Ç—Ä–æ–∫–∞</th>
                        <th>–î–∞–Ω–Ω—ã–µ</th>
                        <th>–û—à–∏–±–∫–∏</th>
                    </tr>
                </thead>
                <tbody>
                    {% for invalid in invalid_data|slice:":10" %}
                    <tr>
                        <td>{{ invalid.row_number }}</td>
                        <td>{{ invalid.identifier|default:"‚Äî" }} | {{ invalid.name|default:"‚Äî"|truncatechars:30 }}</td>
                        <td style="color: #c53030;">
                            {% for error in invalid.errors %}
                                <div>‚Ä¢ {{ error }}</div>
                            {% endfor %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            {% if invalid_data|length > 10 %}
            <p style="color: #666; font-style: italic; margin-top: 10px;">
                ... –∏ –µ—â—ë {{ invalid_data|length|add:"-10" }} –æ—à–∏–±–æ–∫
            </p>
            {% endif %}
        </div>
    </div>
    {% endif %}
    
    <!-- üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ -->
    <div class="section">
        <div class="section-header">üéØ –ò—Ç–æ–≥–∏ –∏–º–ø–æ—Ä—Ç–∞</div>
        <div class="section-content">
            <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                <ul style="margin: 0; padding-left: 20px;">
                    {% if statistics.categories_created %}
                    <li><strong>üìÇ –°–æ–∑–¥–∞–Ω–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:</strong> {{ statistics.categories_created }}</li>
                    {% endif %}
                    {% if statistics.categories_updated %}
                    <li><strong>üìÇ –û–±–Ω–æ–≤–ª–µ–Ω–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:</strong> {{ statistics.categories_updated }}</li>
                    {% endif %}
                    {% if statistics.products_created %}
                    <li><strong>üõçÔ∏è –°–æ–∑–¥–∞–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤:</strong> {{ statistics.products_created }}</li>
                    {% endif %}
                    {% if statistics.products_updated %}
                    <li><strong>üõçÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤:</strong> {{ statistics.products_updated }}</li>
                    {% endif %}
                    {% if statistics.images_processed %}
                    <li><strong>üñºÔ∏è –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:</strong> {{ statistics.images_processed }}</li>
                    {% endif %}
                    {% if statistics.errors %}
                    <li style="color: #dc3545;"><strong>‚ùå –û—à–∏–±–æ–∫:</strong> {{ statistics.errors }}</li>
                    {% endif %}
                </ul>
            </div>
            
            {% if results.success %}
            <div style="background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin-top: 15px;">
                <strong>üéâ –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ!</strong>
                –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- üöÄ –î–µ–π—Å—Ç–≤–∏—è -->
    <div style="text-align: center; margin: 30px 0;">
        <a href="{% url 'import_form' %}" class="btn-primary">
            üì§ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –µ—â—ë —Ñ–∞–π–ª
        </a>
        
        <a href="{% url 'admin:products_product_changelist' %}" class="btn-secondary">
            üìã –ü–µ—Ä–µ–π—Ç–∏ –∫ —Ç–æ–≤–∞—Ä–∞–º
        </a>
        
        <a href="{% url 'admin:products_category_changelist' %}" class="btn-secondary">
            üìÇ –ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        </a>
    </div>
</div>
{% endblock %}