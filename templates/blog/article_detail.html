<!-- üìÅ templates/blog/article_detail.html - –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ç–∞—Ç—å–∏ —Å Quill Editor -->
<!-- üé® –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è QuillField –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->

{% extends "base/base.html" %}
{% load static %}

{% block title %}{{ article.title }}{% endblock %}

{% block start %}
<style>
    /* üé® –°—Ç–∏–ª–∏ –¥–ª—è WYSIWYG –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑ Quill Editor */
    .quill-content {
        line-height: 1.8;
        font-size: 1.05rem;
        color: #333;
    }

    .quill-content h1,
    .quill-content h2,
    .quill-content h3,
    .quill-content h4,
    .quill-content h5,
    .quill-content h6 {
        margin-top: 2rem;
        margin-bottom: 1rem;
        color: #2c3e50;
        font-weight: 600;
    }

    .quill-content h1 { font-size: 2rem; }
    .quill-content h2 { font-size: 1.75rem; }
    .quill-content h3 { font-size: 1.5rem; }

    .quill-content p {
        margin-bottom: 1.2rem;
        text-align: justify;
    }

    .quill-content img {
        max-width: 100%;
        height: auto;
        margin: 1.5rem 0;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        display: block;
        margin-left: auto;
        margin-right: auto;
    }

    .quill-content ul,
    .quill-content ol {
        margin: 1.2rem 0;
        padding-left: 2rem;
    }

    .quill-content li {
        margin-bottom: 0.5rem;
    }

    .quill-content blockquote {
        border-left: 4px solid #3498db;
        padding-left: 1.5rem;
        margin: 1.5rem 0;
        color: #666;
        font-style: italic;
        background-color: #f8f9fa;
        padding: 1rem 1.5rem;
        border-radius: 0 8px 8px 0;
    }

    .quill-content code {
        background-color: #f4f4f4;
        padding: 2px 6px;
        border-radius: 4px;
        font-family: 'Courier New', monospace;
        color: #e74c3c;
    }

    .quill-content pre {
        background-color: #2c3e50;
        color: #ecf0f1;
        padding: 1rem;
        border-radius: 8px;
        overflow-x: auto;
        margin: 1.5rem 0;
    }

    .quill-content pre code {
        background: none;
        color: inherit;
        padding: 0;
    }

    .quill-content a {
        color: #3498db;
        text-decoration: none;
        border-bottom: 1px dotted #3498db;
        transition: all 0.3s ease;
    }

    .quill-content a:hover {
        color: #2980b9;
        border-bottom-style: solid;
    }

    .quill-content table {
        width: 100%;
        margin: 1.5rem 0;
        border-collapse: collapse;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .quill-content table td,
    .quill-content table th {
        border: 1px solid #ddd;
        padding: 12px;
        text-align: left;
    }

    .quill-content table th {
        background-color: #3498db;
        color: white;
        font-weight: 600;
    }

    .quill-content table tr:nth-child(even) {
        background-color: #f8f9fa;
    }

    /* üì± –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
        .quill-content {
            font-size: 1rem;
        }
        
        .quill-content h1 { font-size: 1.75rem; }
        .quill-content h2 { font-size: 1.5rem; }
        .quill-content h3 { font-size: 1.25rem; }
        
        .quill-content table {
            font-size: 0.9rem;
        }
    }

    /* üéØ –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç—å–∏ */
    .article-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 3rem 0;
        margin-bottom: 2rem;
    }

    .article-meta {
        color: rgba(255,255,255,0.8);
        margin-top: 1rem;
    }

    .article-image {
        width: 100%;
        height: 400px;
        object-fit: cover;
        border-radius: 12px;
        margin-bottom: 2rem;
        box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }

    .sidebar {
        background-color: #f8f9fa;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.1);
    }

    .related-article {
        padding: 1rem;
        margin-bottom: 1rem;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .related-article:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        transform: translateY(-2px);
    }
</style>

<div class="article-header">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb bg-transparent p-0">
                        <li class="breadcrumb-item">
                            <a href="{% url 'index' %}" class="text-white-50">–ì–ª–∞–≤–Ω–∞—è</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="{% url 'blog:article_list' %}" class="text-white-50">–°—Ç–∞—Ç—å–∏</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="{% url 'blog:category_articles' article.category.slug %}" class="text-white-50">
                                {{ article.category.name }}
                            </a>
                        </li>
                        <li class="breadcrumb-item active text-white">{{ article.title }}</li>
                    </ol>
                </nav>
                
                <h1 class="display-4 fw-bold mb-3">{{ article.title }}</h1>
                
                <div class="article-meta">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <i class="bi bi-person-circle"></i> 
                            {{ article.author.get_full_name|default:article.author.username }}
                            
                            <span class="mx-3">|</span>
                            
                            <i class="bi bi-calendar3"></i>
                            {{ article.published_at|date:"d F Y" }}
                            
                            <span class="mx-3">|</span>
                            
                            <i class="bi bi-eye"></i>
                            {{ article.views }} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
                            
                            <span class="mx-3">|</span>
                            
                            <i class="bi bi-clock"></i>
                            {{ article.reading_time }} –º–∏–Ω —á—Ç–µ–Ω–∏—è
                        </div>
                        <div class="col-md-4 text-md-end">
                            <span class="badge bg-light text-dark fs-6">
                                {{ article.category.name }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container py-4">
    <div class="row">
        <!-- üìÑ –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="col-lg-8">
            <!-- üñºÔ∏è –ì–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
            {% if article.featured_image %}
                <img src="{{ article.featured_image.url }}" 
                     alt="{{ article.title }}" 
                     class="article-image">
            {% endif %}

            <!-- üìù –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å) -->
            {% if article.excerpt %}
                <div class="alert alert-info mb-4">
                    <div class="quill-content">
                        <!-- üîÑ –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è QuillField -->
                        {% if article.excerpt.html %}
                            {{ article.excerpt.html|safe }}
                        {% else %}
                            {{ article.excerpt|safe }}
                        {% endif %}
                    </div>
                </div>
            {% endif %}

            <!-- üìÑ –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç–∞—Ç—å–∏ -->
            <div class="quill-content">
                <!-- üîÑ –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è QuillField -->
                {% if article.content.html %}
                    {{ article.content.html|safe }}
                {% else %}
                    {{ article.content|safe }}
                {% endif %}
            </div>

            <!-- üîó –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Å—Ç–∞—Ç—å—è–º–∏ -->
            <div class="row mt-5">
                <div class="col-md-6">
                    {% if previous_article %}
                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-subtitle mb-2 text-muted">
                                    <i class="bi bi-arrow-left"></i> –ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç–∞—Ç—å—è
                                </h6>
                                <h5 class="card-title">
                                    <a href="{{ previous_article.get_absolute_url }}" class="text-decoration-none">
                                        {{ previous_article.title }}
                                    </a>
                                </h5>
                            </div>
                        </div>
                    {% endif %}
                </div>
                <div class="col-md-6">
                    {% if next_article %}
                        <div class="card">
                            <div class="card-body text-end">
                                <h6 class="card-subtitle mb-2 text-muted">
                                    –°–ª–µ–¥—É—é—â–∞—è —Å—Ç–∞—Ç—å—è <i class="bi bi-arrow-right"></i>
                                </h6>
                                <h5 class="card-title">
                                    <a href="{{ next_article.get_absolute_url }}" class="text-decoration-none">
                                        {{ next_article.title }}
                                    </a>
                                </h5>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- üì± –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="col-lg-4">
            <div class="sidebar">
                <!-- üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                <h5 class="mb-3">
                    <i class="bi bi-folder"></i> –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
                </h5>
                <div class="list-group list-group-flush mb-4">
                    {% for category in categories %}
                        <a href="{% url 'blog:category_articles' category.slug %}" 
                           class="list-group-item list-group-item-action border-0 ps-0
                           {% if category.slug == article.category.slug %}active{% endif %}">
                            {{ category.name }}
                            <span class="badge bg-secondary float-end">
                                {{ category.get_articles_count }}
                            </span>
                        </a>
                    {% endfor %}
                </div>

                <!-- üîó –ü–æ—Ö–æ–∂–∏–µ —Å—Ç–∞—Ç—å–∏ -->
                {% if related_articles %}
                    <h5 class="mb-3">
                        <i class="bi bi-bookmark"></i> –ü–æ—Ö–æ–∂–∏–µ —Å—Ç–∞—Ç—å–∏
                    </h5>
                    {% for related in related_articles %}
                        <div class="related-article">
                            <h6>
                                <a href="{{ related.get_absolute_url }}" class="text-decoration-none">
                                    {{ related.title }}
                                </a>
                            </h6>
                            <small class="text-muted">
                                <i class="bi bi-calendar3"></i>
                                {{ related.published_at|date:"d.m.Y" }}
                                
                                <span class="mx-2">|</span>
                                
                                <i class="bi bi-eye"></i>
                                {{ related.views }}
                            </small>
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è Quill –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // üñºÔ∏è Lazy loading –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –∫–æ–Ω—Ç–µ–Ω—Ç–µ
        const images = document.querySelectorAll('.quill-content img');
        if ('IntersectionObserver' in window) {
            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.style.opacity = '0';
                        img.style.transition = 'opacity 0.3s';
                        img.onload = () => {
                            img.style.opacity = '1';
                        };
                        observer.unobserve(img);
                    }
                });
            });

            images.forEach(img => imageObserver.observe(img));
        }

        // üîó –í–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
        document.querySelectorAll('.quill-content a').forEach(link => {
            if (link.hostname !== location.hostname) {
                link.target = '_blank';
                link.rel = 'noopener noreferrer';
            }
        });
    });
</script>
{% endblock %}