{% extends "base/base.html"%}
{% comment %}
üõ•Ô∏è –¢–û–ß–ù–ê–Ø –ö–û–ü–ò–Ø templates/product/product.html
‚ùå –£–ë–†–ê–ù–û –¢–û–õ–¨–ö–û: –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ –∏ –ø–æ–¥–ø—è—Ç–Ω–∏–∫
‚úÖ –í–°–ï –û–°–¢–ê–õ–¨–ù–û–ï: –æ–¥–∏–Ω-–≤-–æ–¥–∏–Ω –∫–∞–∫ —É –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
{% endcomment %}
{% block title %}{{product.product_name}} {% endblock %}
{% block start %} {% load crispy_forms_tags %}

<!-- ‚≠ê –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï CSS –ò JS –î–õ–Ø –ó–í–ï–ó–î–û–ß–ï–ö -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è –∑—É–º–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
#mainImage {
max-width: 100%;
height: auto;
object-fit: contain;
transition: transform 0.25s ease;
cursor: zoom-in;
}

.zoomed-in {
transform: scale(2);
cursor: zoom-out;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ª–∞–π–∫–æ–≤/–¥–∏–∑–ª–∞–π–∫–æ–≤ */
.like-btn {
background-color: #59ee8d;
color: #fff;
border: none;
border-radius: 20px;
padding: 0.4rem 1rem;
transition: all 0.3s ease;
font-weight: bold;
}

.like-btn:hover {
background-color: #45c16b;
transform: scale(1.1);
box-shadow: 0 0 10px rgba(89, 238, 141, 0.5);
}

.dislike-btn {
background-color: #ff7675;
color: #fff;
border: none;
border-radius: 20px;
padding: 0.4rem 1rem;
transition: all 0.3s ease;
font-weight: bold;
}

.dislike-btn:hover {
background-color: #d65a5a;
transform: scale(1.1);
box-shadow: 0 0 10px rgba(255, 118, 117, 0.5);
}

@media (max-width: 768px) {
.like-btn,
.dislike-btn {
padding: 0.3rem 0.8rem;
font-size: 0.9rem;
}
}

/* –£–º–µ–Ω—å—à–µ–Ω–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏ - –≤ 2 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ */
.content-body > div,
.content-body > form {
margin-bottom: 10px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 20px */
}

.content-body label {
margin-bottom: 5px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 10px */
}

.kit-options {
gap: 5px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 10px */
 margin-bottom: 10px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 20px */
}

.kit-option-label {
margin-bottom: 5px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 10px */
 padding: 5px 10px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 10px 15px */
}

.form-group {
margin-bottom: 10px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 20px */
}

hr {
margin-top: 10px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 20px */
 margin-bottom: 10px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 20px */
}

/* –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –∫–æ–≤—Ä–∏–∫–æ–≤ */
.product-visualizer {
position: relative;
width: 100%;
max-width: 380px;
margin: 10px auto; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 15px */
 min-height: 220px;
}

.product-visualizer img {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: auto;
transition: all 0.3s ease;
}

.kit-base-image {
z-index: 1;
border: none !important;
}

.matcolor {
z-index: 2;
}

.bordercolor {
z-index: 3;
}

.podpicon {
z-index: 4;
}

/* üõ•Ô∏è –ù–û–í–´–ï —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–º–µ—Ä–æ–≤ –ª–æ–¥–æ–∫ */
.boat-dimensions {
background: linear-gradient(135deg, #e3f2fd 0%, #f0f8ff 100%);
border: 2px solid #2196f3;
border-radius: 12px;
padding: 20px;
margin: 20px 0;
text-align: center;
}

.boat-dimensions h6 {
color: #1976d2;
font-weight: 600;
margin-bottom: 15px;
font-size: 1.1rem;
}

.boat-dimensions ul {
list-style: none;
padding: 0;
margin: 0;
display: flex;
justify-content: center;
gap: 30px;
flex-wrap: wrap;
}

.boat-dimensions li {
background: rgba(33, 150, 243, 0.1);
padding: 10px 20px;
border-radius: 25px;
font-weight: 500;
color: #1565c0;
display: flex;
align-items: center;
gap: 8px;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ü–≤–µ—Ç–æ–≤ */
.color-wrapper {
position: relative;
margin-bottom: 8px;
}

.color-picker {
display: flex;
flex-wrap: nowrap;
margin-bottom: 5px;
}

@media (min-width: 768px) {
.color-picker {
flex-wrap: wrap;
}

.scroll-indicator {
display: none;
}
}

@media (max-width: 767px) {
.color-wrapper {
position: relative;
overflow: hidden;
}

.color-picker {
overflow-x: auto;
-webkit-overflow-scrolling: touch;
padding: 5px 3px;
margin: -5px -3px 0;
scrollbar-width: none;
}

.color-picker::-webkit-scrollbar {
display: none;
}

.scroll-indicator {
display: flex;
align-items: center;
justify-content: center;
font-size: 12px;
color: #666;
margin-top: 3px;
}

.scroll-indicator i {
margin: 0 3px;
}
}

.color-selection {
flex: 0 0 auto;
margin: 0 2px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫—Ä—É–∂–∫–∞–º–∏ */
 text-align: center;
}

@media (min-width: 768px) {
.color-selection {
margin: 0 6px 5px 0;
}
}

.color-item {
display: inline-block;
width: 28px; /* –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä –∫—Ä—É–∂–∫–æ–≤ */
height: 28px; /* –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä –∫—Ä—É–∂–∫–æ–≤ */
border-radius: 50%;
cursor: pointer;
border: 2px solid #ccc;
transition: all 0.2s ease;
margin: 0 auto;
}

.color-item:hover {
transform: scale(1.1);
border-color: #999;
}

.color-item.active {
border: 2px solid #FFEB3B;
box-shadow: 0 0 5px rgba(0,0,0,0.5);
}

.color-name {
font-size: 10px; /* –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ */
margin-top: 2px;
text-align: center;
min-width: 50px; /* –£–º–µ–Ω—å—à–µ–Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
}

@media (max-width: 767px) {
.color-item {
width: 32px;
height: 32px;
}

.color-name {
font-size: 11px;
min-width: 50px;
}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏ —Ç–æ–≤–∞—Ä–∞ */
.img-big-wrap {
margin-bottom: 10px;
text-align: center;
}

.carousel-item {
display: none;
}

.carousel-item.active {
display: block;
}

.carousel-inner {
position: relative;
}

.thumbs-wrap {
display: flex;
flex-wrap: wrap;
justify-content: center;
margin-top: 8px;
}

.item-thumb {
margin: 0 3px;
cursor: pointer;
}

.item-thumb img {
width: 50px;
height: 50px;
object-fit: cover;
border: 1px solid #ddd;
border-radius: 4px;
transition: all 0.2s ease;
}

.item-thumb img:hover {
border-color: #007bff;
transform: scale(1.05);
}

/* –°–∫—Ä—ã—Ç—å –≥–∞–ª–µ—Ä–µ—é –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
@media (max-width: 767px) {
.gallery-wrap {
display: none;
}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è */
.product-description-block {
    background-color: #f9f9f9; border-radius: 8px; padding: 15px; margin: 15px 0;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}
.product-description-block h4 {
    color: #333; border-bottom: 2px solid #2a41e8; padding-bottom: 8px; margin-bottom: 15px; font-weight: 600;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Ü–µ–Ω—ã */
.quantity-price-block {
border-top: 1px solid #eee;
border-bottom: 1px solid #eee;
padding: 8px 0;
margin: 8px 0;
background-color: #f8f8f8;
border-radius: 5px;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ */
.kit-configuration-image {
max-width: 300px;
width: 100%;
height: auto;
margin: 5px auto;
border: 1px solid #eee;
border-radius: 5px;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Ü–µ–Ω—ã */
.quantity-and-price {
display: flex;
justify-content: space-between;
align-items: center;
margin-top: 15px;
}

.quantity-selector {
display: flex;
align-items: center;
}

.quantity-selector button {
border: none;
background-color: #f0f0f0;
padding: 5px 10px;
cursor: pointer;
}

.quantity-selector input {
width: 40px;
text-align: center;
border: 1px solid #ccc;
margin: 0 5px;
}

.final-price {
font-size: 1.2em;
font-weight: bold;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è WYSIWYG –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
.wysiwyg-content {
line-height: 1.6;
font-size: 1rem;
color: #333;
}

.wysiwyg-content h1,
.wysiwyg-content h2,
.wysiwyg-content h3,
.wysiwyg-content h4,
.wysiwyg-content h5,
.wysiwyg-content h6 {
margin-top: 1.5rem;
margin-bottom: 1rem;
color: #2c3e50;
font-weight: 600;
}

.wysiwyg-content img {
max-width: 100%;
height: auto;
margin: 1rem 0;
border-radius: 8px;
box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.wysiwyg-content ul,
.wysiwyg-content ol {
margin: 1rem 0;
padding-left: 2rem;
}

.wysiwyg-content li {
margin-bottom: 0.5rem;
}

.wysiwyg-content blockquote {
border-left: 4px solid #2a41e8;
padding-left: 1rem;
margin: 1rem 0;
color: #666;
font-style: italic;
background-color: #f8f9fa;
padding: 1rem;
border-radius: 0 8px 8px 0;
}

.wysiwyg-content code {
background-color: #f4f4f4;
padding: 2px 6px;
border-radius: 4px;
font-family: 'Courier New', monospace;
color: #e74c3c;
}

.wysiwyg-content a {
color: #2a41e8;
text-decoration: none;
border-bottom: 1px dotted #2a41e8;
}

.wysiwyg-content a:hover {
border-bottom-style: solid;
}

.wysiwyg-content table {
width: 100%;
margin: 1rem 0;
border-collapse: collapse;
border: 1px solid #ddd;
}

.wysiwyg-content table td,
.wysiwyg-content table th {
border: 1px solid #ddd;
padding: 8px;
text-align: left;
}

.wysiwyg-content table th {
background-color: #f5f5f5;
font-weight: bold;
}

/* ‚≠ê –°–¢–ò–õ–ò –î–õ–Ø –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–• –ó–í–ï–ó–î–û–ß–ï–ö */
.star-rating-widget { display: flex; align-items: center; gap: 5px; margin: 10px 0; padding: 10px 0; }
.star-rating-widget .star { font-size: 1.8rem; color: #ddd; cursor: pointer; transition: all 0.2s ease; position: relative; display: inline-block; padding: 2px; }
.star-rating-widget .star:hover { transform: scale(1.1); color: #ffc107; }
.star-rating-widget .star.active { color: #ffc107; text-shadow: 0 0 5px rgba(255, 193, 7, 0.3); }
.star-rating-widget .star.hover { color: #ffc107; }

/* üé® –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞ –≤ –æ—Ç–∑—ã–≤–∞—Ö */
.review-stars { display: inline-flex; align-items: center; gap: 2px; margin-right: 10px; }
.review-stars .star { font-size: 1rem; color: #ffc107; }
.review-stars .star.empty { color: #ddd; }

/* üéØ –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã –æ—Ç–∑—ã–≤–∞ */
.review-form-container { background: #f8f9fa; border-radius: 12px; padding: 20px; margin: 20px 0; border: 1px solid #e9ecef; }
.review-form-container h5 { color: #495057; margin-bottom: 15px; font-weight: 600; }
.review-form-group { margin-bottom: 20px; }
.review-form-group label { font-weight: 600; color: #495057; margin-bottom: 8px; display: block; }
.review-content-textarea { border-radius: 8px; border: 1px solid #ced4da; padding: 12px; font-size: 1rem; resize: vertical; min-height: 100px; }
.review-content-textarea:focus { border-color: #007bff; box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25); outline: 0; }
.review-submit-btn {
    background: linear-gradient(45deg, #007bff, #0056b3); border: none; padding: 12px 30px; border-radius: 8px;
    color: white; font-weight: 600; cursor: pointer; transition: all 0.3s ease;
}
.review-submit-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3); }

/* ‚úÖ –°—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
.review-success-message { background: #d4edda; color: #155724; padding: 12px 16px; border-radius: 8px; border: 1px solid #c3e6cb; margin: 15px 0; }
.review-error-message { background: #f8d7da; color: #721c24; padding: 12px 16px; border-radius: 8px; border: 1px solid #f5c6cb; margin: 15px 0; }

/* üîí –°—Ç–∏–ª–∏ –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ */
.pending-review {
    background: #fff3cd; color: #856404; padding: 12px 16px; border-radius: 8px; border: 1px solid #ffeaa7;
    margin: 15px 0; display: flex; align-items: center; gap: 10px;
}
.pending-review i { font-size: 1.2rem; color: #f39c12; }

/* üì± –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤ */
.review-card { transition: all 0.3s ease; border-left: 4px solid #59ee8d; }
.review-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.like-btn-static, .dislike-btn-static {
    background-color: #f8f9fa; color: #6c757d; border: none; border-radius: 20px;
    padding: 0.3rem 0.8rem; font-size: 0.9rem; cursor: not-allowed;
}
.moderation-status { border-top: 1px solid rgba(255, 193, 7, 0.3); padding-top: 8px; }
.auth-required-message {
    background: #f8f9fa; border-radius: 12px; padding: 30px; border: 2px dashed #dee2e6;
}
.no-reviews-message { background: #f8f9fa; border-radius: 12px; margin: 20px 0; }

/* üìä –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ */
.character-counter { font-size: 0.85rem; color: #6c757d; text-align: right; margin-top: 5px; }
.character-counter.near-limit { color: #e74c3c; font-weight: 600; }

/* üì± –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
@media (max-width: 768px) {
    .star-rating-widget .star { font-size: 1.6rem; gap: 3px; }
    .review-stars .star { font-size: 0.9rem; }
    .review-actions { flex-direction: column; align-items: stretch; gap: 8px; }
    .review-actions .btn { justify-content: center; width: 100%; }
}

</style>

<section class="section-content padding-y">
 <div class="container mt-3">
 {% include 'base/alert.html' %}
<div class="card">
 <div class="row no-gutters">
 <aside class="col-md-4">
 <div class="product-visualizer mx-auto mt-4 mb-4">
 <img class="matcolor" src="/media/images/schema/sota1.png" alt="–ö–æ–≤—Ä–∏–∫">
 <img class="bordercolor" src="/media/images/schema/border211.png" alt="–û–∫–∞–Ω—Ç–æ–≤–∫–∞">
 <!-- üõ•Ô∏è –£–ë–†–ê–ù–û: –ø–æ–¥–ø—è—Ç–Ω–∏–∫ –¥–ª—è –ª–æ–¥–æ–∫ -->
 </div>

 <article class="gallery-wrap">
 <div class="text-center mt-2 ml-3 mr-3 img-big-wrap">
 <div class="carousel-inner">
 {% for image in product.images.all %}
<div class="carousel-item {% if forloop.first %}active{% endif %}">
 <img
 id="mainImage"
 src="/media/{{ image.image }}"
 alt="{{ product.product_name }}"
 />
 </div>
 {% empty %}
 {% for image in product.product_images.all %}
<div class="carousel-item {% if forloop.first %}active{% endif %}">
 <img
 id="mainImage"
 src="/media/{{ image.image }}"
 alt="{{ product.product_name }}"
 />
 </div>
 {% endfor %}
 {% endfor %}
</div>

 <div class="form-row thumbs-wrap mt-5 d-flex justify-content-center">
 {% for image in product.images.all %}
<p class="item-thumb mx-2">
 <img
 src="/media/{{image.image}}"
 class="img-thumbnail"
 onclick="updateMainImage(this.src)"
 />
 </p>
 {% empty %}
 {% for image in product.product_images.all %}
<p class="item-thumb mx-2">
 <img
 src="/media/{{image.image}}"
 class="img-thumbnail"
 onclick="updateMainImage(this.src)"
 />
 </p>
 {% endfor %}
 {% endfor %}
</div>
 </div>
 </article>
 </aside>
 
 <main class="col-md-8">
 <article class="content-body">
 <h2 class="title">{{product.product_name}}</h2>

 <!-- üõ•Ô∏è –ù–û–í–û–ï: –†–∞–∑–º–µ—Ä—ã –ª–æ–¥–æ—á–Ω–æ–≥–æ –∫–æ–≤—Ä–∏–∫–∞ -->
 {% if product.boat_mat_length and product.boat_mat_width %}
 <div class="boat-dimensions">
 <h6>üìê –†–∞–∑–º–µ—Ä—ã –ª–æ–¥–æ—á–Ω–æ–≥–æ –∫–æ–≤—Ä–∏–∫–∞</h6>
 <ul>
 <li><i class="fas fa-ruler-horizontal"></i> –î–ª–∏–Ω–∞: {{ product.boat_mat_length }} —Å–º</li>
 <li><i class="fas fa-ruler-vertical"></i> –®–∏—Ä–∏–Ω–∞: {{ product.boat_mat_width }} —Å–º</li>
 </ul>
 </div>
 {% endif %}

 <p>–¶–µ–Ω–∞: <span class="price h4" id="price">{{ product.price|default:"0" }}.00 —Ä—É–±.</span></p>

 <!-- üõ•Ô∏è –£–ë–†–ê–ù–û: –ë–ª–æ–∫ –≤—ã–±–æ—Ä–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ (–ö–û–ú–ü–õ–ï–ö–¢–ê–¶–ò–Ø) -->

 <hr>

 <!-- –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞ –∫–æ–≤—Ä–∏–∫–∞ -->
 {% if carpet_colors %}
 <div class="form-group">
 <h6>–¶–≤–µ—Ç –∫–æ–≤—Ä–∏–∫–∞:</h6>
 <div class="color-wrapper">
 <div class="color-picker" data-color-type="carpet">
 {% for color in carpet_colors %}
 <div class="color-selection">
 <div
 class="color-item"
 style="background-color: {{ color.hex_code }};
            {% if color.uid == initial_carpet_color.uid or color.uid == initial_border_color.uid %}border: 2px solid #FFEB3B;{% endif %}
            {% if not color.is_available %}opacity: 0.5; cursor: not-allowed;{% endif %}"
 data-color-uuid="{{ color.uid }}"
 data-image-url="{{ color.get_image_url }}"
data-is-available="{{ color.is_available|yesno:'true,false' }}"
title="{{ color.name }}{% if not color.is_available %} (–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏){% endif %}"
 {% if color.is_available %}onclick="console.log('Carpet click:', this); activateColor(this, 'carpet');"{% endif %}
 ></div>
 <div class="color-name">{{ color.name }}</div>
 </div>
 {% endfor %}
 </div>
 <div class="scroll-indicator">
 <i class="fas fa-arrow-left"></i>
 –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤
 <i class="fas fa-arrow-right"></i>
 </div>
 </div>
 </div>
 {% endif %}

 <!-- –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞ –æ–∫–∞–Ω—Ç–æ–≤–∫–∏ -->
 {% if border_colors %}
 <div class="form-group">
 <h6>–¶–≤–µ—Ç –æ–∫–∞–Ω—Ç–æ–≤–∫–∏:</h6>
 <div class="color-wrapper">
 <div class="color-picker" data-color-type="border">
 {% for color in border_colors %}
 <div class="color-selection">
 <div
 class="color-item"
 style="background-color: {{ color.hex_code }};
            {% if color.uid == initial_carpet_color.uid or color.uid == initial_border_color.uid %}border: 2px solid #FFEB3B;{% endif %}
            {% if not color.is_available %}opacity: 0.5; cursor: not-allowed;{% endif %}"
 data-color-uuid="{{ color.uid }}"
 data-image-url="{{ color.get_image_url }}"
data-is-available="{{ color.is_available|yesno:'true,false' }}"
title="{{ color.name }}{% if not color.is_available %} (–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏){% endif %}"
 {% if color.is_available %}onclick="console.log('Border click:', this); activateColor(this, 'border');"{% endif %}
 ></div>
 <div class="color-name">{{ color.name }}</div>
 </div>
 {% endfor %}
 </div>
 <div class="scroll-indicator">
 <i class="fas fa-arrow-left"></i>
 –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤
 <i class="fas fa-arrow-right"></i>
 </div>
 </div>
 </div>
 {% endif %}

 <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è —Ü–≤–µ—Ç–æ–≤ -->
<input type="hidden" name="carpet_color" id="carpet_color_input" value="{{ initial_carpet_color.uid }}">
<input type="hidden" name="border_color" id="border_color_input" value="{{ initial_border_color.uid }}">

<!-- üõ•Ô∏è –£–ë–†–ê–ù–û: –ü–æ–¥–ø—è—Ç–Ω–∏–∫ -->

 <div class="quantity-and-price">
 <div class="quantity-selector">
 <button type="button" id="button-minus">-</button>
 <input type="text" value="1" id="quantity" />
 <button type="button" id="button-plus">+</button>
 </div>

 <div class="final-price">
 –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: <span class="font-weight-bold" id="finalPrice">{{ product.price|default:"0" }}.00</span>
 </div>
 </div>

 <div class="form-group d-flex justify-content-start mt-3">
 <div class="d-sm-flex">
 <div class="mb-2 mb-sm-0 mr-0 mr-sm-2">
 <form method="POST" action="{% url 'boats:add_to_wishlist' product.uid %}" id="wishlist-form">
 {% csrf_token %}
 <!-- üõ•Ô∏è –£–ë–†–ê–ù–û: kit –¥–ª—è –ª–æ–¥–æ–∫ -->
 <input type="hidden" name="carpet_color" id="wishlist-carpet-color" value="{{ initial_carpet_color.uid }}">
 <input type="hidden" name="border_color" id="wishlist-border-color" value="{{ initial_border_color.uid }}">
 <!-- üõ•Ô∏è –£–ë–†–ê–ù–û: podp –¥–ª—è –ª–æ–¥–æ–∫ -->
 <input type="hidden" name="quantity" id="wishlist-quantity" value="1">
 <button type="submit" class="btn btn-outline-primary">
 <i class="fas fa-heart"></i> –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
</button>
 </form>
 </div>

 <form method="POST" action="{% url 'boats:add_to_cart' product.uid %}" id="cart-form">
 {% csrf_token %}
 <!-- üõ•Ô∏è –£–ë–†–ê–ù–û: kit –¥–ª—è –ª–æ–¥–æ–∫ -->
 <input type="hidden" name="carpet_color" id="cart-carpet-color" value="{{ initial_carpet_color.uid }}">
 <input type="hidden" name="border_color" id="cart-border-color" value="{{ initial_border_color.uid }}">
 <!-- üõ•Ô∏è –£–ë–†–ê–ù–û: podp –¥–ª—è –ª–æ–¥–æ–∫ -->
 <input type="hidden" name="quantity" id="cart-quantity" value="1">
 <button type="submit" class="btn btn-primary">
 <i class="fas fa-shopping-bag mr-1"></i>
 <span>–í –∫–æ—Ä–∑–∏–Ω—É</span>
 </button>
 </form>
 </div>
 </div>
 </article>
 </main>
 </div>
 </div>

 <div class="product-description-block mt-4 mb-4">
 <h4>–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</h4>
    <div class="wysiwyg-content">
        {% if product.product_desription.html %}
            {{ product.product_desription.html|safe }}
        {% else %}
            {{ product.product_desription|safe }}
        {% endif %}
    </div>
 </div>
 
        <!-- ‚≠ê –ù–û–í–´–ô –ë–õ–û–ö –û–¢–ó–´–í–û–í –° –ó–í–ï–ó–î–û–ß–ö–ê–ú–ò –ò –ú–û–î–ï–†–ê–¶–ò–ï–ô (–î–õ–Ø –í–°–ï–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô) -->
        <div class="reviews-section mt-4">
            <h3 class="title padding-bottom-sm d-flex align-items-center">
                <i class="fas fa-comments me-2"></i>
                –û—Ç–∑—ã–≤—ã
                {% if reviews %}
                <span class="badge bg-primary ms-2">{{ reviews.count }}</span>
                {% endif %}
            </h3>

            <!-- ‚ö†Ô∏è –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –û –ú–û–î–ï–†–ê–¶–ò–ò -->
            {% if messages %}
                {% for message in messages %}
                    {% if '–º–æ–¥–µ—Ä–∞—Ü–∏—é' in message.message or '–æ–∂–∏–¥–∞–µ—Ç' in message.message %}
                    <div class="pending-review">
                        <i class="fas fa-clock"></i>
                        <span>{{ message.message }}</span>
                    </div>
                    {% elif message.tags == 'success' %}
                    <div class="review-success-message">
                        <i class="fas fa-check-circle me-2"></i>{{ message.message }}
                    </div>
                    {% elif message.tags == 'error' %}
                    <div class="review-error-message">
                        <i class="fas fa-exclamation-triangle me-2"></i>{{ message.message }}
                    </div>
                    {% endif %}
                {% endfor %}
            {% endif %}

            <!-- ‚úÖ –û–¢–ó–´–í–´ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π qs) -->
            {% for review in reviews %}
            <div class="card mb-3 review-card">
                <div class="card-body" style="background-color: #59ee8d91">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="review-content flex-grow-1">
                            <div class="review-header mb-2">
                                <div class="d-flex align-items-center mb-2">
                                    <!-- üë§ –ê–≤—Ç–æ—Ä: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–ª–∏ –≥–æ—Å—Ç—å -->
                                    <strong class="me-3">
                                        {% if review.user %}
                                            {{ review.user.get_full_name|default:review.user.username }}
                                        {% else %}
                                            {{ review.reviewer_name|default:"–ê–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" }}
                                        {% endif %}
                                    </strong>

                                    <div class="review-stars me-2">
                                        {% for star in "12345" %}
                                            {% if forloop.counter <= review.stars %}
                                                <i class="fas fa-star"></i>
                                            {% else %}
                                                <i class="fas fa-star empty"></i>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                    <small class="text-muted">{{ review.date_added|date:"d.m.Y –≤ H:i" }}</small>
                                </div>
                            </div>

                            <div class="review-text">
                                <p class="mb-2">{{ review.content }}</p>
                            </div>
                        </div>

                        <!-- üëçüëé –ö–ù–û–ü–ö–ò –õ–ê–ô–ö/–î–ò–ó–õ–ê–ô–ö –ò –î–ï–ô–°–¢–í–ò–Ø -->
                        <div class="review-actions d-flex flex-wrap align-items-center gap-2">
                            {% if request.user.is_authenticated %}
                            <button class="btn like-btn d-flex align-items-center" onclick="toggleLike('{{ review.uid }}')" title="–ù—Ä–∞–≤–∏—Ç—Å—è">
                                <i class="fas fa-thumbs-up me-1"></i>
                                <span id="like-count-{{ review.uid }}">{{ review.like_count }}</span>
                            </button>

                            <button class="btn dislike-btn d-flex align-items-center" onclick="toggleDislike('{{ review.uid }}')" title="–ù–µ –Ω—Ä–∞–≤–∏—Ç—Å—è">
                                <i class="fas fa-thumbs-down me-1"></i>
                                <span id="dislike-count-{{ review.uid }}">{{ review.dislike_count }}</span>
                            </button>
                            {% else %}
                            <!-- –î–ª—è –≥–æ—Å—Ç–µ–π ‚Äî —Ç–æ–ª—å–∫–æ —Å—á–µ—Ç—á–∏–∫–∏ -->
                            <span class="like-btn-static d-flex align-items-center" title="–í–æ–π–¥–∏—Ç–µ –¥–ª—è –æ—Ü–µ–Ω–∫–∏">
                                <i class="fas fa-thumbs-up me-1"></i>
                                <span>{{ review.like_count }}</span>
                            </span>
                            <span class="dislike-btn-static d-flex align-items-center" title="–í–æ–π–¥–∏—Ç–µ –¥–ª—è –æ—Ü–µ–Ω–∫–∏">
                                <i class="fas fa-thumbs-down me-1"></i>
                                <span>{{ review.dislike_count }}</span>
                            </span>
                            {% endif %}

                            <!-- üóëÔ∏è –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∞ -->
                            {% if review.user == request.user %}
                            <button class="btn btn-outline-danger btn-sm"
                                    title="–£–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤"
                                    data-bs-toggle="modal"
                                    data-bs-target="#deleteReviewModal"
                                    onclick="setDeleteAction('{% url 'delete_review' product.slug review.uid %}')">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                            {% endif %}

                            <!-- üë®‚Äçüíº –ö–Ω–æ–ø–∫–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ -->
                            {% if request.user.is_staff %}
                                {% if not review.is_approved %}
                                <button class="btn btn-success btn-sm" onclick="moderateReview('{{ review.uid }}', 'approve')" title="–û–¥–æ–±—Ä–∏—Ç—å –æ—Ç–∑—ã–≤">
                                    <i class="fas fa-check"></i> –û–¥–æ–±—Ä–∏—Ç—å
                                </button>
                                {% endif %}
                                <button class="btn btn-warning btn-sm" onclick="moderateReview('{{ review.uid }}', 'reject')" title="–û—Ç–∫–ª–æ–Ω–∏—Ç—å –æ—Ç–∑—ã–≤">
                                    <i class="fas fa-times"></i> –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="no-reviews-message text-center py-4">
                <i class="fas fa-comment-slash fa-3x text-muted mb-3"></i>
                <p class="text-muted">–û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
            </div>
            {% endfor %}

            <!-- ‚úçÔ∏è –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–ê–Ø –§–û–†–ú–ê –î–û–ë–ê–í–õ–ï–ù–ò–Ø –û–¢–ó–´–í–ê (–î–õ–Ø –í–°–ï–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô) -->
            <div class="review-form-container">
                <h5>
                    <i class="fas fa-edit me-2"></i>
                    {% if user_existing_review %}
                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à –æ—Ç–∑—ã–≤
                    {% else %}
                        –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤
                    {% endif %}
                </h5>

                <form method="POST" action="{% url 'boats:product_detail' product.slug %}" class="review-form" id="reviewForm">
                    {% csrf_token %}

                    {% if not request.user.is_authenticated %}
                    <!-- üçØ Honeypot -->
                    <input type="text" name="website" style="display:none;" tabindex="-1" autocomplete="off">
                    <!-- ‚è±Ô∏è –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ -->
                    <input type="hidden" name="form_timestamp" value="{{ form_timestamp }}">
                    {% endif %}

                    {% if not request.user.is_authenticated %}
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="review-form-group">
                                <label for="id_reviewer_name">–í–∞—à–µ –∏–º—è <span class="text-danger">*</span></label>
                                <input type="text" name="reviewer_name" id="id_reviewer_name" class="form-control"
                                       placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?" required maxlength="100"
                                       value="{% if review_form.reviewer_name.value %}{{ review_form.reviewer_name.value }}{% endif %}">
                                {% if review_form.reviewer_name.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in review_form.reviewer_name.errors %}
                                        <i class="fas fa-exclamation-triangle me-1"></i>{{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="review-form-group">
                                <label for="id_reviewer_email">Email <span class="text-muted">(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–µ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è)</span></label>
                                <input type="email" name="reviewer_email" id="id_reviewer_email" class="form-control"
                                       placeholder="–¥–ª—è —Å–≤—è–∑–∏ (–Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è)" maxlength="254"
                                       value="{% if review_form.reviewer_email.value %}{{ review_form.reviewer_email.value }}{% endif %}">
                                <small class="form-text text-muted"><i class="fas fa-lock me-1"></i>Email –Ω–µ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤—è–∑–∏</small>
                                {% if review_form.reviewer_email.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in review_form.reviewer_email.errors %}
                                        <i class="fas fa-exclamation-triangle me-1"></i>{{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- ‚≠ê –û—Ü–µ–Ω–∫–∞ -->
                    <div class="review-form-group">
                        <label>–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞ <span class="text-danger">*</span></label>
                        <div class="star-rating-widget" data-field-name="stars">
                            <input type="hidden" name="stars"
                                   value="{% if user_existing_review %}{{ user_existing_review.stars }}{% elif review_form.stars.value %}{{ review_form.stars.value }}{% else %}0{% endif %}"
                                   id="id_stars">
                            {% for i in "12345" %}
                            <span class="star
                                {% if user_existing_review and forloop.counter <= user_existing_review.stars %}active{% elif review_form.stars.value and forloop.counter <= review_form.stars.value %}active{% endif %}"
                                  data-value="{{ forloop.counter }}"
                                  title="{{ forloop.counter }} –∑–≤–µ–∑–¥{% if forloop.counter == 1 %}–∞{% elif forloop.counter <= 4 %}—ã{% endif %}">
                                <i class="fas fa-star"></i>
                            </span>
                            {% endfor %}
                        </div>
                        <small class="form-text text-muted">–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∑–≤–µ–∑–¥–æ—á–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –æ—Ü–µ–Ω–∫–∏</small>

                        {% if review_form.stars.errors %}
                        <div class="invalid-feedback d-block">
                            {% for error in review_form.stars.errors %}<i class="fas fa-exclamation-triangle me-1"></i>{{ error }}{% endfor %}
                        </div>
                        {% endif %}
                    </div>

                    <!-- üìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π -->
                    <div class="review-form-group">
                        <label for="id_content">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π <span class="text-danger">*</span></label>
                        <textarea name="content" id="id_content" class="form-control review-content-textarea" rows="4"
                                  placeholder="–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –≤–∞—à–∏–º –º–Ω–µ–Ω–∏–µ–º –æ —Ç–æ–≤–∞—Ä–µ..." maxlength="1000" required>{% if user_existing_review %}{{ user_existing_review.content }}{% elif review_form.content.value %}{{ review_form.content.value }}{% endif %}</textarea>
                        <small class="form-text text-muted">–ú–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤, –º–∞–∫—Å–∏–º—É–º 1000</small>

                        {% if review_form.content.errors %}
                        <div class="invalid-feedback d-block">
                            {% for error in review_form.content.errors %}<i class="fas fa-exclamation-triangle me-1"></i>{{ error }}{% endfor %}
                        </div>
                        {% endif %}
                    </div>

                    <!-- üöÄ –û—Ç–ø—Ä–∞–≤–∫–∞ -->
                    <div class="text-end">
                        <button type="submit" name="review_submit" class="review-submit-btn">
                            <i class="fas fa-paper-plane me-2"></i>
                            {% if user_existing_review %}–û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–∑—ã–≤{% else %}–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤{% endif %}
                        </button>
                    </div>

                    <!-- üí° –ò–Ω—Ñ–æ –æ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ -->
                    <div class="moderation-info mt-3">
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            –í—Å–µ –æ—Ç–∑—ã–≤—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –º–æ–¥–µ—Ä–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π.
                            {% if user_existing_review and not user_existing_review.is_approved %}
                                –í–∞—à —Ç–µ–∫—É—â–∏–π –æ—Ç–∑—ã–≤ –æ–∂–∏–¥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏.
                            {% endif %}
                            {% if not request.user.is_authenticated %}
                                –î–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–¥–∞–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞ –≤ –±—É–¥—É—â–µ–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É.
                            {% endif %}
                        </small>
                    </div>
                </form>
            </div>

        </div>

        <!-- üóëÔ∏è –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –£–î–ê–õ–ï–ù–ò–Ø –û–¢–ó–´–í–ê (–¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö) -->
        <div class="modal fade" id="deleteReviewModal" tabindex="-1" aria-labelledby="deleteReviewModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteReviewModalLabel">
                            <i class="fas fa-trash me-2"></i>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="text-center">
                            <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                            <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç–∑—ã–≤?</p>
                            <p class="text-muted small">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-1"></i>–û—Ç–º–µ–Ω–∞
                        </button>
                        <form id="deleteReviewForm" method="POST" style="display: inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger">
                                <i class="fas fa-trash me-1"></i>–£–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>
</section>

<!-- üîß –°–ö–†–´–¢–´–ï –î–ê–ù–ù–´–ï –î–õ–Ø JavaScript -->
<meta name="product-price" content="{{ product.price }}">
<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

<script>
 // JavaScript —Ñ—É–Ω–∫—Ü–∏–∏ (–¢–û–ß–ù–ê–Ø –ö–û–ü–ò–Ø –° PRODUCTS)
 let selectedCarpetColor = '';
 let selectedBorderColor = '';
 let document.getElementById('quantity').value = 1;

 // –§—É–Ω–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–ª–∞–≤–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
 function updateMainImage(imageSrc) {
   document.getElementById('mainImage').src = imageSrc;
 }

 // –ó—É–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
 document.getElementById('mainImage').addEventListener('click', function() {
   this.classList.toggle('zoomed-in');
 });

 // üé® –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ü–≤–µ—Ç–∞ (–°–ò–ù–•–†–û–ù–ò–ó–ò–†–û–í–ê–ù–û –° –ê–í–¢–û–ú–û–ë–ò–õ–Ø–ú–ò)
 function activateColor(element, type) {
   // ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ü–≤–µ—Ç–∞
   const isAvailable = element.dataset.isAvailable === 'true';
   if (!isAvailable) {
     console.warn('–ü–æ–ø—ã—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞');
     return;
   }

   // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç–æ–≥–æ –∂–µ —Ç–∏–ø–∞
   document.querySelectorAll(`.color-picker[data-color-type="${type}"] .color-item`).forEach(item => {
     item.classList.remove('active');
     item.style.border = '2px solid #ccc';
   });

   // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
   element.classList.add('active');
   element.style.border = '2px solid #FFEB3B';

   // –ü–æ–ª—É—á–∞–µ–º UUID —Ü–≤–µ—Ç–∞ –∏ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   const colorUUID = element.getAttribute('data-color-uuid');
   const imageUrl = element.getAttribute('data-image-url');

   // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è
   if (type === 'carpet') {
     const carpetColorInput = document.getElementById('carpet_color_input');
     if (carpetColorInput) carpetColorInput.value = colorUUID;

     // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã –∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
     const cartField = document.getElementById('cart-carpet-color');
     const wishlistField = document.getElementById('wishlist-carpet-color');
     if (cartField) cartField.value = colorUUID;
     if (wishlistField) wishlistField.value = colorUUID;

     // üñºÔ∏è –û–±–Ω–æ–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–≤—Ä–∏–∫–∞
     const matcolorImg = document.querySelector('.matcolor');
     if (matcolorImg && imageUrl) {
       matcolorImg.src = imageUrl;
     }

   } else if (type === 'border') {
     const borderColorInput = document.getElementById('border_color_input');
     if (borderColorInput) borderColorInput.value = colorUUID;

     // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã –∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
     const cartField = document.getElementById('cart-border-color');
     const wishlistField = document.getElementById('wishlist-border-color');
     if (cartField) cartField.value = colorUUID;
     if (wishlistField) wishlistField.value = colorUUID;

     // üñºÔ∏è –û–±–Ω–æ–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–∫–∞–Ω—Ç–æ–≤–∫–∏
     const borderImg = document.querySelector('.bordercolor');
     if (borderImg && imageUrl) {
       borderImg.src = imageUrl;
     }
   }

   console.log(`–í—ã–±—Ä–∞–Ω —Ü–≤–µ—Ç ${type}: ${colorUUID}`);
 }

 // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
 function updateConfig() {
   // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã
   document.getElementById('cart-quantity').value = document.getElementById('quantity').value;
   document.getElementById('wishlist-quantity').value = document.getElementById('quantity').value;
 }

 // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
 /* document.getElementById('button-plus').addEventListener('click', function() {
   const quantityInput = document.getElementById('quantity');
   // –£–¥–∞–ª–µ–Ω–æ - –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–æ –≤ product.js
   quantityInput.value = document.getElementById('quantity').value;
   updateConfig();
 });

 document.getElementById('button-minus').addEventListener('click', function() {
   const quantityInput = document.getElementById('quantity');
   if (document.getElementById('quantity').value > 1) {
     document.getElementById('quantity').value = parseInt(quantityInput.value) - 1;
     quantityInput.value = document.getElementById('quantity').value;
     updateConfig();
   }
 });

// ‚≠ê –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É–¥–∞–ª–µ–Ω—ã - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –±–ª–æ–∫–∞ –≤—ã—à–µ
</script>

<!-- üõ•Ô∏è –ü–µ—Ä–µ–¥–∞—á–∞ —Ç–∏–ø–∞ —Ç–æ–≤–∞—Ä–∞ –≤ JavaScript -->
<script>window.isBoatProduct = true;</script>

<!-- ‚≠ê JAVASCRIPT –î–õ–Ø –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–• –ó–í–ï–ó–î–û–ß–ï–ö -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    initializeStarRatingWidgets();
    initializeCharacterCounter();
});

function initializeStarRatingWidgets() {
    const widgets = document.querySelectorAll('.star-rating-widget');
    widgets.forEach(widget => {
        const stars = widget.querySelectorAll('.star');
        const hiddenInput = widget.querySelector('input[type="hidden"]');
        if (!hiddenInput) return;

        stars.forEach(star => {
            const starValue = parseInt(star.getAttribute('data-value'));
            star.addEventListener('click', function() {
                setRating(widget, starValue, hiddenInput);
                clearHoverEffect(stars);
            });
            star.addEventListener('mouseenter', function() { showHoverEffect(stars, starValue); });
            star.addEventListener('mouseleave', function() {
                clearHoverEffect(stars);
                restoreCurrentRating(widget, hiddenInput);
            });
        });

        restoreCurrentRating(widget, hiddenInput);
    });
}

function setRating(widget, rating, hiddenInput) {
    hiddenInput.value = rating;
    const stars = widget.querySelectorAll('.star');
    stars.forEach(star => {
        const starValue = parseInt(star.getAttribute('data-value'));
        if (starValue <= rating) { star.classList.add('active'); star.classList.remove('hover'); }
        else { star.classList.remove('active', 'hover'); }
    });
    showRatingConfirmation(widget, rating);
    clearValidationErrors(widget);
}

function showHoverEffect(stars, hoverRating) {
    stars.forEach(star => {
        const starValue = parseInt(star.getAttribute('data-value'));
        if (starValue <= hoverRating) star.classList.add('hover');
        else star.classList.remove('hover');
    });
}
function clearHoverEffect(stars) { stars.forEach(star => star.classList.remove('hover')); }

function restoreCurrentRating(widget, hiddenInput) {
    const currentRating = parseInt(hiddenInput.value) || 0;
    const stars = widget.querySelectorAll('.star');
    stars.forEach(star => {
        const starValue = parseInt(star.getAttribute('data-value'));
        if (starValue <= currentRating) star.classList.add('active'); else star.classList.remove('active');
        star.classList.remove('hover');
    });
}

function showRatingConfirmation(widget, rating) {
    const existing = widget.querySelector('.rating-confirmation'); if (existing) existing.remove();
    const el = document.createElement('div');
    el.className = 'rating-confirmation';
    el.style.cssText = 'color:#28a745;font-size:.9rem;font-weight:600;margin-left:15px;opacity:0;transition:opacity .3s ease;';
    el.innerHTML = '<i class="fas fa-check-circle"></i> ' + getRatingText(rating);
    widget.appendChild(el);
    setTimeout(()=>{ el.style.opacity='1'; },100);
    setTimeout(()=>{ if(el.parentNode){ el.style.opacity='0'; setTimeout(()=>{ if(el.parentNode){ el.remove(); } },300); } },3000);
}
function getRatingText(rating){
    const t={1:'–û—á–µ–Ω—å –ø–ª–æ—Ö–æ',2:'–ü–ª–æ—Ö–æ',3:'–ù–æ—Ä–º–∞–ª—å–Ω–æ',4:'–•–æ—Ä–æ—à–æ',5:'–û—Ç–ª–∏—á–Ω–æ'}; return t[rating] || '–û—Ü–µ–Ω–∫–∞ –≤—ã–±—Ä–∞–Ω–∞';
}
function clearValidationErrors(widget){
    const errs = widget.parentNode.querySelectorAll('.invalid-feedback, .error-message');
    errs.forEach(e=>e.style.display='none');
    const group = widget.closest('.form-group, .review-form-group');
    if (group) group.classList.remove('has-error','is-invalid');
}

function initializeCharacterCounter(){
    const textareas=document.querySelectorAll('.review-content-textarea');
    textareas.forEach(textarea=>{
        const maxLength=parseInt(textarea.getAttribute('maxlength'))||1000;
        const counter=document.createElement('div');
        counter.className='character-counter';
        counter.textContent=`0 / ${maxLength}`;
        textarea.parentNode.insertBefore(counter, textarea.nextSibling);
        textarea.addEventListener('input', function(){
            const n=this.value.length;
            counter.textContent=`${n} / ${maxLength}`;
            if(n>maxLength*0.9){counter.classList.add('near-limit');}else{counter.classList.remove('near-limit');}
        });
        textarea.dispatchEvent(new Event('input'));
    });
}

// üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ
function setDeleteAction(url) { document.getElementById('deleteReviewForm').action = url; }

// üë®‚Äçüíº –ú–æ–¥–µ—Ä–∞—Ü–∏—è
function moderateReview(reviewUid, action) {
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    fetch(`/products/moderate-review/${reviewUid}/${action}/`, {
        method: 'POST',
        headers: { 'X-CSRFToken': csrfToken, 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: action, review_uid: reviewUid })
    })
    .then(r=>r.json())
    .then(data=>{
        if(data.success){ location.reload(); }
        else{ alert('–û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞')); }
    })
    .catch(err=>{ console.error('–û—à–∏–±–∫–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏:', err); alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –æ—Ç–∑—ã–≤–∞'); });
}

// üëçüëé –õ–∞–π–∫/–¥–∏–∑–ª–∞–π–∫
function toggleLike(reviewUid){
    const csrfToken=document.querySelector('[name=csrfmiddlewaretoken]').value;
    fetch(`/products/toggle-like/${reviewUid}/`, { method:'POST', headers:{'X-CSRFToken':csrfToken,'Content-Type':'application/json'} })
    .then(r=>r.json())
    .then(d=>{ if(d.success){ document.getElementById(`like-count-${reviewUid}`).textContent=d.likes; document.getElementById(`dislike-count-${reviewUid}`).textContent=d.dislikes; } })
    .catch(e=>console.error('–û—à–∏–±–∫–∞ –ª–∞–π–∫–∞:', e));
}
function toggleDislike(reviewUid){
    const csrfToken=document.querySelector('[name=csrfmiddlewaretoken]').value;
    fetch(`/products/toggle-dislike/${reviewUid}/`, { method:'POST', headers:{'X-CSRFToken':csrfToken,'Content-Type':'application/json'} })
    .then(r=>r.json())
    .then(d=>{ if(d.success){ document.getElementById(`like-count-${reviewUid}`).textContent=d.likes; document.getElementById(`dislike-count-${reviewUid}`).textContent=d.dislikes; } })
    .catch(e=>console.error('–û—à–∏–±–∫–∞ –¥–∏–∑–ª–∞–π–∫–∞:', e));
}

// üìù –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ —Ñ–æ—Ä–º—É –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
document.addEventListener('DOMContentLoaded', function(){
    const hasFormErrors = document.querySelector('.invalid-feedback');
    if (hasFormErrors) {
        const reviewForm = document.getElementById('reviewForm');
        if (reviewForm) reviewForm.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
});
</script>

<!-- üîß –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –û–°–ù–û–í–ù–û–ì–û JS –§–ê–ô–õ–ê -->
<script src="/media/js/product.js" type="text/javascript"></script>

{% endblock %}