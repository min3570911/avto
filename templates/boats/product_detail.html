{% extends "base/base.html"%}
{% comment %}
üõ•Ô∏è –¢–û–ß–ù–ê–Ø –ö–û–ü–ò–Ø templates/product/product.html
‚ùå –£–ë–†–ê–ù–û –¢–û–õ–¨–ö–û: –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ –∏ –ø–æ–¥–ø—è—Ç–Ω–∏–∫
‚úÖ –í–°–ï –û–°–¢–ê–õ–¨–ù–û–ï: –æ–¥–∏–Ω-–≤-–æ–¥–∏–Ω –∫–∞–∫ —É –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
{% endcomment %}
{% block title %}{{product.product_name}} {% endblock %}
{% block start %} {% load crispy_forms_tags %}

<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è –∑—É–º–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
#mainImage {
max-width: 100%;
height: auto;
object-fit: contain;
transition: transform 0.25s ease;
cursor: zoom-in;
}

.zoomed-in {
transform: scale(2);
cursor: zoom-out;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ª–∞–π–∫–æ–≤/–¥–∏–∑–ª–∞–π–∫–æ–≤ */
.like-btn {
background-color: #59ee8d;
color: #fff;
border: none;
border-radius: 20px;
padding: 0.4rem 1rem;
transition: all 0.3s ease;
font-weight: bold;
}

.like-btn:hover {
background-color: #45c16b;
transform: scale(1.1);
box-shadow: 0 0 10px rgba(89, 238, 141, 0.5);
}

.dislike-btn {
background-color: #ff7675;
color: #fff;
border: none;
border-radius: 20px;
padding: 0.4rem 1rem;
transition: all 0.3s ease;
font-weight: bold;
}

.dislike-btn:hover {
background-color: #d65a5a;
transform: scale(1.1);
box-shadow: 0 0 10px rgba(255, 118, 117, 0.5);
}

@media (max-width: 768px) {
.like-btn,
.dislike-btn {
padding: 0.3rem 0.8rem;
font-size: 0.9rem;
}
}

/* –£–º–µ–Ω—å—à–µ–Ω–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏ - –≤ 2 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ */
.content-body > div,
.content-body > form {
margin-bottom: 10px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 20px */
}

.content-body label {
margin-bottom: 5px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 10px */
}

.kit-options {
gap: 5px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 10px */
 margin-bottom: 10px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 20px */
}

.kit-option-label {
margin-bottom: 5px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 10px */
 padding: 5px 10px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 10px 15px */
}

.form-group {
margin-bottom: 10px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 20px */
}

hr {
margin-top: 10px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 20px */
 margin-bottom: 10px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 20px */
}

/* –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –∫–æ–≤—Ä–∏–∫–æ–≤ */
.product-visualizer {
position: relative;
width: 100%;
max-width: 380px;
margin: 10px auto; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Å 15px */
 min-height: 220px;
}

.product-visualizer img {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: auto;
transition: all 0.3s ease;
}

.kit-base-image {
z-index: 1;
border: none !important;
}

.matcolor {
z-index: 2;
}

.bordercolor {
z-index: 3;
}

.podpicon {
z-index: 4;
}

/* üõ•Ô∏è –ù–û–í–´–ï —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–º–µ—Ä–æ–≤ –ª–æ–¥–æ–∫ */
.boat-dimensions {
background: linear-gradient(135deg, #e3f2fd 0%, #f0f8ff 100%);
border: 2px solid #2196f3;
border-radius: 12px;
padding: 20px;
margin: 20px 0;
text-align: center;
}

.boat-dimensions h6 {
color: #1976d2;
font-weight: 600;
margin-bottom: 15px;
font-size: 1.1rem;
}

.boat-dimensions ul {
list-style: none;
padding: 0;
margin: 0;
display: flex;
justify-content: center;
gap: 30px;
flex-wrap: wrap;
}

.boat-dimensions li {
background: rgba(33, 150, 243, 0.1);
padding: 10px 20px;
border-radius: 25px;
font-weight: 500;
color: #1565c0;
display: flex;
align-items: center;
gap: 8px;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ü–≤–µ—Ç–æ–≤ */
.color-wrapper {
position: relative;
margin-bottom: 8px;
}

.color-picker {
display: flex;
flex-wrap: nowrap;
margin-bottom: 5px;
}

@media (min-width: 768px) {
.color-picker {
flex-wrap: wrap;
}

.scroll-indicator {
display: none;
}
}

@media (max-width: 767px) {
.color-wrapper {
position: relative;
overflow: hidden;
}

.color-picker {
overflow-x: auto;
-webkit-overflow-scrolling: touch;
padding: 5px 3px;
margin: -5px -3px 0;
scrollbar-width: none;
}

.color-picker::-webkit-scrollbar {
display: none;
}

.scroll-indicator {
display: flex;
align-items: center;
justify-content: center;
font-size: 12px;
color: #666;
margin-top: 3px;
}

.scroll-indicator i {
margin: 0 3px;
}
}

.color-selection {
flex: 0 0 auto;
margin: 0 2px; /* –£–º–µ–Ω—å—à–µ–Ω–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫—Ä—É–∂–∫–∞–º–∏ */
 text-align: center;
}

@media (min-width: 768px) {
.color-selection {
margin: 0 6px 5px 0;
}
}

.color-item {
display: inline-block;
width: 28px; /* –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä –∫—Ä—É–∂–∫–æ–≤ */
height: 28px; /* –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä –∫—Ä—É–∂–∫–æ–≤ */
border-radius: 50%;
cursor: pointer;
border: 2px solid #ccc;
transition: all 0.2s ease;
margin: 0 auto;
}

.color-item:hover {
transform: scale(1.1);
border-color: #999;
}

.color-item.active {
border: 2px solid #FFEB3B;
box-shadow: 0 0 5px rgba(0,0,0,0.5);
}

.color-name {
font-size: 10px; /* –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ */
margin-top: 2px;
text-align: center;
min-width: 50px; /* –£–º–µ–Ω—å—à–µ–Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
}

@media (max-width: 767px) {
.color-item {
width: 32px;
height: 32px;
}

.color-name {
font-size: 11px;
min-width: 50px;
}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏ —Ç–æ–≤–∞—Ä–∞ */
.img-big-wrap {
margin-bottom: 10px;
text-align: center;
}

.carousel-item {
display: none;
}

.carousel-item.active {
display: block;
}

.carousel-inner {
position: relative;
}

.thumbs-wrap {
display: flex;
flex-wrap: wrap;
justify-content: center;
margin-top: 8px;
}

.item-thumb {
margin: 0 3px;
cursor: pointer;
}

.item-thumb img {
width: 50px;
height: 50px;
object-fit: cover;
border: 1px solid #ddd;
border-radius: 4px;
transition: all 0.2s ease;
}

.item-thumb img:hover {
border-color: #007bff;
transform: scale(1.05);
}

/* –°–∫—Ä—ã—Ç—å –≥–∞–ª–µ—Ä–µ—é –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
@media (max-width: 767px) {
.gallery-wrap {
display: none;
}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è */
.product-description-block {
background-color: #f9f9f9;
border-radius: 8px;
padding: 10px;
margin: 10px 0;
box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.product-description-block h4 {
color: #333;
border-bottom: 1px solid #ddd;
padding-bottom: 5px;
margin-bottom: 8px;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Ü–µ–Ω—ã */
.quantity-price-block {
border-top: 1px solid #eee;
border-bottom: 1px solid #eee;
padding: 8px 0;
margin: 8px 0;
background-color: #f8f8f8;
border-radius: 5px;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ */
.kit-configuration-image {
max-width: 300px;
width: 100%;
height: auto;
margin: 5px auto;
border: 1px solid #eee;
border-radius: 5px;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Ü–µ–Ω—ã */
.quantity-and-price {
display: flex;
justify-content: space-between;
align-items: center;
margin-top: 15px;
}

.quantity-selector {
display: flex;
align-items: center;
}

.quantity-selector button {
border: none;
background-color: #f0f0f0;
padding: 5px 10px;
cursor: pointer;
}

.quantity-selector input {
width: 40px;
text-align: center;
border: 1px solid #ccc;
margin: 0 5px;
}

.final-price {
font-size: 1.2em;
font-weight: bold;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è WYSIWYG –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
.wysiwyg-content {
line-height: 1.6;
font-size: 1rem;
color: #333;
}

.wysiwyg-content h1,
.wysiwyg-content h2,
.wysiwyg-content h3,
.wysiwyg-content h4,
.wysiwyg-content h5,
.wysiwyg-content h6 {
margin-top: 1.5rem;
margin-bottom: 1rem;
color: #2c3e50;
font-weight: 600;
}

.wysiwyg-content img {
max-width: 100%;
height: auto;
margin: 1rem 0;
border-radius: 8px;
box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.wysiwyg-content ul,
.wysiwyg-content ol {
margin: 1rem 0;
padding-left: 2rem;
}

.wysiwyg-content li {
margin-bottom: 0.5rem;
}

.wysiwyg-content blockquote {
border-left: 4px solid #2a41e8;
padding-left: 1rem;
margin: 1rem 0;
color: #666;
font-style: italic;
background-color: #f8f9fa;
padding: 1rem;
border-radius: 0 8px 8px 0;
}

.wysiwyg-content code {
background-color: #f4f4f4;
padding: 2px 6px;
border-radius: 4px;
font-family: 'Courier New', monospace;
color: #e74c3c;
}

.wysiwyg-content a {
color: #2a41e8;
text-decoration: none;
border-bottom: 1px dotted #2a41e8;
}

.wysiwyg-content a:hover {
border-bottom-style: solid;
}

.wysiwyg-content table {
width: 100%;
margin: 1rem 0;
border-collapse: collapse;
border: 1px solid #ddd;
}

.wysiwyg-content table td,
.wysiwyg-content table th {
border: 1px solid #ddd;
padding: 8px;
text-align: left;
}

.wysiwyg-content table th {
background-color: #f5f5f5;
font-weight: bold;
}

</style>

<section class="section-content padding-y">
 <div class="container mt-3">
 {% include 'base/alert.html' %}
<div class="card">
 <div class="row no-gutters">
 <aside class="col-md-4">
 <div class="product-visualizer mx-auto mt-4 mb-4">
 <img class="matcolor" src="/media/images/schema/sota1.png" alt="–ö–æ–≤—Ä–∏–∫">
 <img class="bordercolor" src="/media/images/schema/border211.png" alt="–û–∫–∞–Ω—Ç–æ–≤–∫–∞">
 <!-- üõ•Ô∏è –£–ë–†–ê–ù–û: –ø–æ–¥–ø—è—Ç–Ω–∏–∫ –¥–ª—è –ª–æ–¥–æ–∫ -->
 </div>

 <article class="gallery-wrap">
 <div class="text-center mt-2 ml-3 mr-3 img-big-wrap">
 <div class="carousel-inner">
 {% for image in product.images.all %}
<div class="carousel-item {% if forloop.first %}active{% endif %}">
 <img
 id="mainImage"
 src="/media/{{ image.image }}"
 alt="{{ product.product_name }}"
 />
 </div>
 {% empty %}
 {% for image in product.product_images.all %}
<div class="carousel-item {% if forloop.first %}active{% endif %}">
 <img
 id="mainImage"
 src="/media/{{ image.image }}"
 alt="{{ product.product_name }}"
 />
 </div>
 {% endfor %}
 {% endfor %}
</div>

 <div class="form-row thumbs-wrap mt-5 d-flex justify-content-center">
 {% for image in product.images.all %}
<p class="item-thumb mx-2">
 <img
 src="/media/{{image.image}}"
 class="img-thumbnail"
 onclick="updateMainImage(this.src)"
 />
 </p>
 {% empty %}
 {% for image in product.product_images.all %}
<p class="item-thumb mx-2">
 <img
 src="/media/{{image.image}}"
 class="img-thumbnail"
 onclick="updateMainImage(this.src)"
 />
 </p>
 {% endfor %}
 {% endfor %}
</div>
 </div>
 </article>
 </aside>
 
 <main class="col-md-8">
 <article class="content-body">
 <h2 class="title">{{product.product_name}}</h2>

 <!-- üõ•Ô∏è –ù–û–í–û–ï: –†–∞–∑–º–µ—Ä—ã –ª–æ–¥–æ—á–Ω–æ–≥–æ –∫–æ–≤—Ä–∏–∫–∞ -->
 {% if product.boat_mat_length and product.boat_mat_width %}
 <div class="boat-dimensions">
 <h6>üìê –†–∞–∑–º–µ—Ä—ã –ª–æ–¥–æ—á–Ω–æ–≥–æ –∫–æ–≤—Ä–∏–∫–∞</h6>
 <ul>
 <li><i class="fas fa-ruler-horizontal"></i> –î–ª–∏–Ω–∞: {{ product.boat_mat_length }} —Å–º</li>
 <li><i class="fas fa-ruler-vertical"></i> –®–∏—Ä–∏–Ω–∞: {{ product.boat_mat_width }} —Å–º</li>
 </ul>
 </div>
 {% endif %}

 <p>–¶–µ–Ω–∞: <span class="price h4" id="price">{{product.price|default:product.get_product_price_by_kit}}.00 —Ä—É–±.</span></p>

 <!-- üõ•Ô∏è –£–ë–†–ê–ù–û: –ë–ª–æ–∫ –≤—ã–±–æ—Ä–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ (–ö–û–ú–ü–õ–ï–ö–¢–ê–¶–ò–Ø) -->

 <hr>

 <!-- –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞ –∫–æ–≤—Ä–∏–∫–∞ -->
 {% if colors_carpet %}
 <div class="form-group">
 <h6>–¶–≤–µ—Ç –∫–æ–≤—Ä–∏–∫–∞:</h6>
 <div class="color-wrapper">
 <div class="color-picker" id="carpet-color-picker">
 {% for color in colors_carpet %}
 <div class="color-selection">
 <div
 class="color-item"
 style="background-color: {{ color.hex_code }};"
 data-color="{{ color.uid }}"
 data-name="{{ color.name }}"
 onclick="selectColor(this, 'carpet')"
 ></div>
 <div class="color-name">{{ color.name }}</div>
 </div>
 {% endfor %}
 </div>
 <div class="scroll-indicator">
 <i class="fas fa-arrow-left"></i>
 –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤
 <i class="fas fa-arrow-right"></i>
 </div>
 </div>
 </div>
 {% endif %}

 <!-- –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞ –æ–∫–∞–Ω—Ç–æ–≤–∫–∏ -->
 {% if colors_border %}
 <div class="form-group">
 <h6>–¶–≤–µ—Ç –æ–∫–∞–Ω—Ç–æ–≤–∫–∏:</h6>
 <div class="color-wrapper">
 <div class="color-picker" id="border-color-picker">
 {% for color in colors_border %}
 <div class="color-selection">
 <div
 class="color-item"
 style="background-color: {{ color.hex_code }};"
 data-color="{{ color.uid }}"
 data-name="{{ color.name }}"
 onclick="selectColor(this, 'border')"
 ></div>
 <div class="color-name">{{ color.name }}</div>
 </div>
 {% endfor %}
 </div>
 <div class="scroll-indicator">
 <i class="fas fa-arrow-left"></i>
 –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤
 <i class="fas fa-arrow-right"></i>
 </div>
 </div>
 </div>
 {% endif %}

 <!-- üõ•Ô∏è –£–ë–†–ê–ù–û: –ü–æ–¥–ø—è—Ç–Ω–∏–∫ -->

 <div class="quantity-and-price">
 <div class="quantity-selector">
 <button type="button" id="button-minus">-</button>
 <input type="text" value="1" id="quantity" />
 <button type="button" id="button-plus">+</button>
 </div>

 <div class="final-price">
 –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: <span class="font-weight-bold" id="finalPrice">{{ product.price|default:product.get_product_price_by_kit }}.00</span>
 </div>
 </div>

 <div class="form-group d-flex justify-content-start mt-3">
 <div class="d-sm-flex">
 <div class="mb-2 mb-sm-0 mr-0 mr-sm-2">
 <form method="POST" action="{% url 'add_to_wishlist' product.uid %}" id="wishlist-form">
 {% csrf_token %}
 <!-- üõ•Ô∏è –£–ë–†–ê–ù–û: kit –¥–ª—è –ª–æ–¥–æ–∫ -->
 <input type="hidden" name="carpet_color" id="wishlist-carpet-color" value="">
 <input type="hidden" name="border_color" id="wishlist-border-color" value="">
 <!-- üõ•Ô∏è –£–ë–†–ê–ù–û: podp –¥–ª—è –ª–æ–¥–æ–∫ -->
 <input type="hidden" name="quantity" id="wishlist-quantity" value="1">
 <button type="submit" class="btn btn-outline-primary">
 <i class="fas fa-heart"></i> –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
</button>
 </form>
 </div>

 <form method="POST" action="{% url 'add_to_cart' product.uid %}" id="cart-form">
 {% csrf_token %}
 <!-- üõ•Ô∏è –£–ë–†–ê–ù–û: kit –¥–ª—è –ª–æ–¥–æ–∫ -->
 <input type="hidden" name="carpet_color" id="cart-carpet-color" value="">
 <input type="hidden" name="border_color" id="cart-border-color" value="">
 <!-- üõ•Ô∏è –£–ë–†–ê–ù–û: podp –¥–ª—è –ª–æ–¥–æ–∫ -->
 <input type="hidden" name="quantity" id="cart-quantity" value="1">
 <button type="submit" class="btn btn-primary">
 <i class="fas fa-shopping-bag mr-1"></i>
 <span>–í –∫–æ—Ä–∑–∏–Ω—É</span>
 </button>
 </form>
 </div>
 </div>
 </article>
 </main>
 </div>
 </div>

 <div class="product-description-block mt-4 mb-4">
 <h4>–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</h4>
    <div class="wysiwyg-content">
        {% if product.product_desription.html %}
            {{ product.product_desription.html|safe }}
        {% else %}
            {{ product.product_desription|safe }}
        {% endif %}
    </div>
 </div>
 
 <h3 class="title padding-bottom-sm">–û—Ç–∑—ã–≤—ã</h3>

 {% for review in product.reviews.all %}
<div class="card mb-3">
 <div class="card-body" style="background-color: #59ee8d91">
 <div class="d-flex justify-content-between align-items-center">
 <div>
 <p>
 <strong>–î–∞—Ç–∞: </strong>{{ review.date_added|date:"Y-m-d" }} –æ—Ç
<strong>{{ review.user.get_full_name }}</strong><br />
 <strong>–û—Ü–µ–Ω–∫–∞: </strong>{{ review.stars }}/5<br />
 <strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: </strong>{{ review.content }}
</p>
 </div>
 <div class="d-flex flex-wrap align-items-center gap-2">
 {% if request.user.is_authenticated %}
<button
 class="btn like-btn d-flex align-items-center"
 onclick="toggleLike('{{ review.uid }}')"
 >
 <i class="fas fa-thumbs-up me-2"></i>
 <span id="like-count-{{ review.uid }}">{{ review.like_count }}</span>
 </button>

 <button
 class="btn dislike-btn d-flex align-items-center"
 onclick="toggleDislike('{{ review.uid }}')"
 >
 <i class="fas fa-thumbs-down me-2"></i>
 <span id="dislike-count-{{ review.uid }}">{{ review.dislike_count }}</span>
 </button>

 {% else %}
<b>–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ü–µ–Ω–∏—Ç—å –æ—Ç–∑—ã–≤</b>
 {% endif %}
 </div>
 </div>
 </div>
</div>
 {% endfor %}

<!-- üìù –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞ (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω) -->
{% if user.is_authenticated %}
<div class="row">
 <div class="col-md-6">
 <div class="card">
 <div class="card-header">
 <h5>–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h5>
 </div>
 <div class="card-body">
 <form method="post" action="">
 {% csrf_token %}
 <div class="form-group">
 <label for="rating">–û—Ü–µ–Ω–∫–∞:</label>
 <div class="rating-stars">
 <input type="radio" name="stars" id="star1" value="1" required>
 <label for="star1">‚≠ê</label>
 <input type="radio" name="stars" id="star2" value="2" required>
 <label for="star2">‚≠ê</label>
 <input type="radio" name="stars" id="star3" value="3" required>
 <label for="star3">‚≠ê</label>
 <input type="radio" name="stars" id="star4" value="4" required>
 <label for="star4">‚≠ê</label>
 <input type="radio" name="stars" id="star5" value="5" required>
 <label for="star5">‚≠ê</label>
 </div>
 </div>
 <div class="form-group">
 <label for="content">–í–∞—à –æ—Ç–∑—ã–≤:</label>
 <textarea name="content" id="content" class="form-control" rows="4" placeholder="–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º–∏ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è–º–∏ –æ —Ç–æ–≤–∞—Ä–µ..." required></textarea>
 </div>
 <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
 </form>
 </div>
 </div>
 </div>
</div>
{% else %}
<div class="alert alert-info">
 <p>–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ <a href="{% url 'login' %}">–≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</a> –∏–ª–∏ <a href="{% url 'register' %}">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>.</p>
</div>
{% endif %}

 </div>
</section>

<script>
 // JavaScript —Ñ—É–Ω–∫—Ü–∏–∏ (–¢–û–ß–ù–ê–Ø –ö–û–ü–ò–Ø –° PRODUCTS)
 let selectedCarpetColor = '';
 let selectedBorderColor = '';
 let selectedQuantity = 1;

 // –§—É–Ω–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–ª–∞–≤–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
 function updateMainImage(imageSrc) {
   document.getElementById('mainImage').src = imageSrc;
 }

 // –ó—É–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
 document.getElementById('mainImage').addEventListener('click', function() {
   this.classList.toggle('zoomed-in');
 });

 // –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞
 function selectColor(element, type) {
   // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏—Ö —Ü–≤–µ—Ç–æ–≤ —Ç–æ–≥–æ –∂–µ —Ç–∏–ø–∞
   const picker = element.closest('.color-picker');
   const allColors = picker.querySelectorAll('.color-item');
   allColors.forEach(color => color.classList.remove('active'));

   // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ü–≤–µ—Ç
   element.classList.add('active');

   const colorId = element.dataset.color;
   const colorName = element.dataset.name;

   if (type === 'carpet') {
     selectedCarpetColor = colorId;
     document.getElementById('cart-carpet-color').value = colorName;
     document.getElementById('wishlist-carpet-color').value = colorName;
   } else if (type === 'border') {
     selectedBorderColor = colorId;
     document.getElementById('cart-border-color').value = colorName;
     document.getElementById('wishlist-border-color').value = colorName;
   }

   updateConfig();
 }

 // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
 function updateConfig() {
   // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã
   document.getElementById('cart-quantity').value = selectedQuantity;
   document.getElementById('wishlist-quantity').value = selectedQuantity;
 }

 // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
 document.getElementById('button-plus').addEventListener('click', function() {
   const quantityInput = document.getElementById('quantity');
   selectedQuantity = parseInt(quantityInput.value) + 1;
   quantityInput.value = selectedQuantity;
   updateConfig();
 });

 document.getElementById('button-minus').addEventListener('click', function() {
   const quantityInput = document.getElementById('quantity');
   if (selectedQuantity > 1) {
     selectedQuantity = parseInt(quantityInput.value) - 1;
     quantityInput.value = selectedQuantity;
     updateConfig();
   }
 });

 // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ª–∞–π–∫–æ–≤/–¥–∏–∑–ª–∞–π–∫–æ–≤ –æ—Ç–∑—ã–≤–æ–≤
 function toggleLike(reviewUid) {
   // AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è –ª–∞–π–∫–∞
   fetch(`/products/like-review/${reviewUid}/`, {
     method: 'POST',
     headers: {
       'Content-Type': 'application/json',
       'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
     }
   })
   .then(response => response.json())
   .then(data => {
     if (data.success) {
       document.getElementById(`like-count-${reviewUid}`).textContent = data.likes;
       document.getElementById(`dislike-count-${reviewUid}`).textContent = data.dislikes;
     }
   })
   .catch(error => console.error('–û—à–∏–±–∫–∞:', error));
 }

 function toggleDislike(reviewUid) {
   // AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è –¥–∏–∑–ª–∞–π–∫–∞
   fetch(`/products/dislike-review/${reviewUid}/`, {
     method: 'POST',
     headers: {
       'Content-Type': 'application/json',
       'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
     }
   })
   .then(response => response.json())
   .then(data => {
     if (data.success) {
       document.getElementById(`like-count-${reviewUid}`).textContent = data.likes;
       document.getElementById(`dislike-count-${reviewUid}`).textContent = data.dislikes;
     }
   })
   .catch(error => console.error('–û—à–∏–±–∫–∞:', error));
 }
</script>

{% endblock %}