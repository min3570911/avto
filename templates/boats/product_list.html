{% extends "base/base.html"%}
{% comment %}
üõ•Ô∏è templates/boats/product_list.html - –ü–û–õ–ù–ê–Ø –ö–û–ü–ò–Ø —Å products/category.html
‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏: —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, —Ñ–∏–ª—å—Ç—Ä—ã, –ø–∞–≥–∏–Ω–∞—Ü–∏—è, –ø–æ–∏—Å–∫ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
üîß –ê–î–ê–ü–¢–ò–†–û–í–ê–ù–û: URL boats, –∫–æ–Ω—Ç–µ–∫—Å—Ç –ª–æ–¥–æ–∫, —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ª–æ–¥–æ–∫
{% endcomment %}
{% load static %}
{% block title %}üõ•Ô∏è {{ category.category_name }} | –õ–æ–¥–æ—á–Ω—ã–µ –∫–æ–≤—Ä–∏–∫–∏{% endblock %}

<!-- üîç SEO –º–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ª–æ–¥–æ–∫ -->
{% block extra_head %}
<meta name="description" content="–õ–æ–¥–æ—á–Ω—ã–µ –∫–æ–≤—Ä–∏–∫–∏ {{ category.category_name }}. –ó–∞–∫–∞–∑–∞—Ç—å –∫–æ–≤—Ä–∏–∫–∏ EVA –¥–ª—è –ª–æ–¥–æ–∫ {{ category.category_name }} –ø–æ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º —Ä–∞–∑–º–µ—Ä–∞–º.">
<meta name="robots" content="index, follow">

<!-- üì± Open Graph –º–µ—Ç–∞-—Ç–µ–≥–∏ -->
<meta property="og:title" content="üõ•Ô∏è –õ–æ–¥–æ—á–Ω—ã–µ –∫–æ–≤—Ä–∏–∫–∏ {{ category.category_name }}">
<meta property="og:description" content="–ö–æ–≤—Ä–∏–∫–∏ EVA –¥–ª—è –ª–æ–¥–æ–∫ {{ category.category_name }}">
<meta property="og:type" content="website">
<meta property="og:site_name" content="–ê–≤—Ç–æ–∫–æ–≤—Ä–∏–∫–∏">
{% if category.category_image %}
<meta property="og:image" content="{{ request.build_absolute_uri }}{{ category.category_image.url }}">
{% endif %}

<!-- üê¶ Twitter Card –º–µ—Ç–∞-—Ç–µ–≥–∏ -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="üõ•Ô∏è –õ–æ–¥–æ—á–Ω—ã–µ –∫–æ–≤—Ä–∏–∫–∏ {{ category.category_name }}">
<meta name="twitter:description" content="–ö–æ–≤—Ä–∏–∫–∏ EVA –¥–ª—è –ª–æ–¥–æ–∫ {{ category.category_name }}">
{% if category.category_image %}
<meta name="twitter:image" content="{{ request.build_absolute_uri }}{{ category.category_image.url }}">
{% endif %}
{% endblock %}

{% block start %}

<style>
  /* üé® –°–ö–û–ü–ò–†–û–í–ê–ù–ù–´–ï —Å—Ç–∏–ª–∏ —Å products/category.html */
  .filter-section {
    margin-bottom: 20px;
  }

  .form-group {
    margin-bottom: 10px;
  }

  /* üÜï –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏ (—Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ —Å products) */
  .control-panel {
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    border: 1px solid #e9ecef;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 30px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }

  .control-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 20px;
    flex-wrap: wrap;
  }

  .control-group {
    display: flex;
    align-items: center;
    gap: 12px;
    min-width: 200px;
  }

  .control-group label {
    font-weight: 600;
    color: #495057;
    margin: 0;
    white-space: nowrap;
    font-size: 14px;
  }

  .control-select {
    border: 2px solid #dee2e6;
    border-radius: 8px;
    padding: 8px 12px;
    background: white;
    color: #495057;
    font-size: 14px;
    min-width: 140px;
    transition: all 0.3s ease;
  }

  .control-select:focus {
    border-color: #2a41e8;
    box-shadow: 0 0 0 3px rgba(42, 65, 232, 0.1);
    outline: none;
  }

  .control-select:hover {
    border-color: #2a41e8;
  }

  /* üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ */
  .products-stats {
    background: #2a41e8;
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
    white-space: nowrap;
  }

  .stats-badge {
    background: rgba(255,255,255,0.2);
    padding: 2px 8px;
    border-radius: 10px;
    margin-left: 8px;
  }

  /* üéØ –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ª–æ–¥–æ–∫ */
  .category-header {
    background: linear-gradient(135deg, #2a41e8 0%, #1976d2 100%);
    color: white;
    padding: 40px 0;
    margin-bottom: 30px;
  }

  .category-image {
    max-height: 120px;
    border-radius: 8px;
    background: white;
    padding: 10px;
  }

  .breadcrumb {
    background: rgba(255,255,255,0.1);
    border-radius: 8px;
  }

  .breadcrumb-item a {
    color: #bbdefb;
    text-decoration: none;
  }

  .breadcrumb-item a:hover {
    color: white;
  }

  .breadcrumb-item.active {
    color: white;
  }

  /* üõ•Ô∏è –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ª–æ–¥–æ–∫ */
  .boat-filters {
    background: #e3f2fd;
    border: 1px solid #2196f3;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
  }

  .boat-dimension-filter {
    display: flex;
    gap: 15px;
    align-items: center;
    flex-wrap: wrap;
  }

  .dimension-group {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .dimension-input {
    width: 80px;
    padding: 6px 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 14px;
  }

  /* üìù –ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–ø–∏—Å–∞–Ω–∏–µ */
  .category-content {
    line-height: 1.8;
    font-size: 1.05rem;
    color: #333;
    margin-bottom: 30px;
  }
  
  .category-content h1,
  .category-content h2,
  .category-content h3,
  .category-content h4 {
    margin-top: 1.5rem;
    margin-bottom: 1rem;
    color: #2c3e50;
    font-weight: 600;
  }
  
  .category-content img {
    max-width: 100%;
    height: auto;
    margin: 1rem 0;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  
  .category-content ul,
  .category-content ol {
    margin: 1rem 0;
    padding-left: 2rem;
  }
  
  .category-content table {
    width: 100%;
    margin: 1rem 0;
    border-collapse: collapse;
  }
  
  .category-content table td,
  .category-content table th {
    border: 1px solid #ddd;
    padding: 8px;
  }
  
  .category-content table th {
    background-color: #f5f5f5;
    font-weight: bold;
  }
  
  .category-content blockquote {
    border-left: 4px solid #2a41e8;
    padding-left: 1rem;
    margin: 1rem 0;
    color: #666;
    font-style: italic;
    background-color: #f8f9fa;
    padding: 1rem;
    border-radius: 0 8px 8px 0;
  }

  /* üé¨ –°—Ç–∏–ª–∏ –¥–ª—è YouTube –≤–∏–¥–µ–æ –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–Ω—Ç–µ */
  .additional-content .youtube-video-container {
    position: relative;
    width: 100%;
    padding-bottom: 56.25%; /* 16:9 —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ */
    height: 0;
    overflow: hidden;
    max-width: 100%;
    background: #000;
    margin: 20px 0;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  .additional-content .youtube-video-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
  }

  /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è YouTube –≤–∏–¥–µ–æ */
  @media (max-width: 768px) {
    .additional-content .youtube-video-container {
      margin: 15px 0;
      border-radius: 6px;
    }
  }
</style>

<!-- üéØ –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ª–æ–¥–æ–∫ -->
<div class="category-header">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-8">
        <!-- üß≠ –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'index' %}">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li class="breadcrumb-item"><a href="{% url 'boats:category_list' %}">üõ•Ô∏è –õ–æ–¥–∫–∏</a></li>
            <li class="breadcrumb-item active">{{ category.category_name }}</li>
          </ol>
        </nav>
        
        <h1>üõ•Ô∏è –õ–æ–¥–æ—á–Ω—ã–µ –∫–æ–≤—Ä–∏–∫–∏ {{ category.category_name }}</h1>
        <p class="mt-3 text-light">–ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: <strong>{{ total_products|default:products.count }}</strong></p>
      </div>
      <div class="col-md-4 text-center">
        {% if category.category_image %}
        <img src="/media/{{ category.category_image }}" class="category-image" alt="{{ category.category_name }}">
        {% else %}
        <i class="fas fa-ship fa-5x text-white"></i>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="container">
  {% include 'base/alert.html' %}

  
  <!-- üÜï –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏ (–°–ö–û–ü–ò–†–û–í–ê–ù–û –° PRODUCTS) -->
  <div class="control-panel">
    <div class="control-row">
      <!-- üìä –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
      <div class="control-group">
        <label for="sort-select">üìä –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å:</label>
        <select id="sort-select" class="control-select" onchange="updateUrl()">
          <option value="">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
          <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>üÜï –°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
          <option value="price" {% if sort_by == 'price' %}selected{% endif %}>üí∞ –î–µ—à–µ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞</option>
          <option value="-price" {% if sort_by == '-price' %}selected{% endif %}>üíé –î–æ—Ä–æ–≥–∏–µ —Å–Ω–∞—á–∞–ª–∞</option>
          <option value="name" {% if sort_by == 'name' %}selected{% endif %}>üî§ –ü–æ –∞–ª—Ñ–∞–≤–∏—Ç—É</option>
        </select>
      </div>

      <!-- üî¢ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ -->
      <div class="control-group">
        <label for="per-page-select">üî¢ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å:</label>
        <select id="per-page-select" class="control-select" onchange="updateUrl()">
          <option value="12" {% if per_page == '12' %}selected{% endif %}>12 —Ç–æ–≤–∞—Ä–æ–≤</option>
          <option value="24" {% if per_page == '24' %}selected{% endif %}>24 —Ç–æ–≤–∞—Ä–∞</option>
          <option value="48" {% if per_page == '48' %}selected{% endif %}>48 —Ç–æ–≤–∞—Ä–æ–≤</option>
          <option value="all" {% if per_page == 'all' %}selected{% endif %}>üîç –í—Å–µ —Ç–æ–≤–∞—Ä—ã</option>
        </select>
      </div>

      <!-- üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div class="products-stats">
        {% if per_page == 'all' %}
          <span>–ü–æ–∫–∞–∑–∞–Ω—ã –≤—Å–µ —Ç–æ–≤–∞—Ä—ã:</span>
          <span class="stats-badge">{{ total_products }}</span>
        {% else %}
          <span>–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ current_page|default:1 }} –∏–∑ {{ total_pages|default:1 }}</span>
          <span class="stats-badge">{{ page_obj.start_index|default:0 }}-{{ page_obj.end_index|default:0 }} –∏–∑ {{ total_products }}</span>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- üõçÔ∏è –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –ª–æ–¥–æ–∫ (–°–ö–û–ü–ò–†–û–í–ê–ù–û –° PRODUCTS) -->
  <div class="row">
    {% for product in products %}
    <div class="col-md-3">
      <figure class="card card-product-grid">
        <div class="img-wrap">
          {% if product.images.first %}
          <img src="/media/{{ product.images.first.image }}" alt="{{ product.product_name }}" />
          {% elif product.product_images.first %}
          <img src="/media/{{ product.product_images.first.image }}" alt="{{ product.product_name }}" />
          {% else %}
          <div style="height: 200px; background: #f8f9fa; display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-ship fa-3x text-muted"></i>
          </div>
          {% endif %}
        </div>
        <figcaption class="info-wrap border-top">
          <a href="{% url 'boats:product_detail' product.slug %}" class="title">
            <b>{{ product.product_name }}</b>
          </a>
          
          <!-- üõ•Ô∏è –†–∞–∑–º–µ—Ä—ã –ª–æ–¥–æ—á–Ω–æ–≥–æ –∫–æ–≤—Ä–∏–∫–∞ -->
          {% if product.boat_mat_length and product.boat_mat_width %}
          <div class="text-muted small mt-1">
            üìê {{ product.boat_mat_length }}√ó{{ product.boat_mat_width }} —Å–º
          </div>
          {% endif %}
          
          <div class="price mt-2">{{ product.get_salon_price|default:"–¶–µ–Ω–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É" }}</div>
        </figcaption>
      </figure>
    </div>
    {% endfor %}
  </div>

  <!-- üìÑ –ü–∞–≥–∏–Ω–∞—Ü–∏—è (–°–ö–û–ü–ò–†–û–í–ê–ù–û –° PRODUCTS) -->
  {% if page_obj.has_other_pages and per_page != 'all' %}
  <nav aria-label="–ü–∞–≥–∏–Ω–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤">
    <ul class="pagination justify-content-center">
      {% if page_obj.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if sort_by %}sort={{ sort_by }}&{% endif %}{% if per_page %}per_page={{ per_page }}&{% endif %}page={{ page_obj.previous_page_number }}">
            ‚Äπ –ü—Ä–µ–¥—ã–¥—É—â–∞—è
          </a>
        </li>
      {% endif %}

      {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
          <li class="page-item active">
            <span class="page-link">{{ num }}</span>
          </li>
        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
          <li class="page-item">
            <a class="page-link" href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if sort_by %}sort={{ sort_by }}&{% endif %}{% if per_page %}per_page={{ per_page }}&{% endif %}page={{ num }}">{{ num }}</a>
          </li>
        {% endif %}
      {% endfor %}

      {% if page_obj.has_next %}
        <li class="page-item">
          <a class="page-link" href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if sort_by %}sort={{ sort_by }}&{% endif %}{% if per_page %}per_page={{ per_page }}&{% endif %}page={{ page_obj.next_page_number }}">
            –°–ª–µ–¥—É—é—â–∞—è ‚Ä∫
          </a>
        </li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}

  <!-- üìù –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ª–æ–¥–æ–∫ -->
  {% if category.description or category.additional_content %}
  <div class="category-content mt-5">
    <h3>üìù –û –ª–æ–¥–æ—á–Ω—ã—Ö –∫–æ–≤—Ä–∏–∫–∞—Ö {{ category.category_name }}</h3>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ -->
    {% if category.description %}
      {{ category.description|safe }}
    {% endif %}

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (YouTube –∏ –¥—Ä.) -->
    {% if category.additional_content %}
      <div class="additional-content mt-4">
        {{ category.additional_content|safe }}
      </div>
    {% endif %}
  </div>
  {% endif %}

  <!-- üõ•Ô∏è –ü—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç -->
  {% if not products %}
  <div class="alert alert-info text-center">
    <h4>üîç –¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ {{ category.category_name }}</h4>
    <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ <a href="{% url 'boats:product_list_by_category' category.slug %}">—Å–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</a></p>
    <p><a href="{% url 'boats:category_list' %}" class="btn btn-primary">üõ•Ô∏è –°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –ª–æ–¥–∫–∏</a></p>
  </div>
  {% endif %}
</div>

<!-- üîß JavaScript –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è URL (–°–ö–û–ü–ò–†–û–í–ê–ù –° PRODUCTS) -->
<script>
function updateUrl() {
  const sortSelect = document.getElementById('sort-select');
  const perPageSelect = document.getElementById('per-page-select');
  
  const urlParams = new URLSearchParams(window.location.search);
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
  if (sortSelect.value) {
    urlParams.set('sort', sortSelect.value);
  } else {
    urlParams.delete('sort');
  }
  
  if (perPageSelect.value && perPageSelect.value !== '12') {
    urlParams.set('per_page', perPageSelect.value);
  } else {
    urlParams.delete('per_page');
  }
  
  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  urlParams.delete('page');
  
  // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º
  window.location.search = urlParams.toString();
}

// üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
  console.log('üõ•Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è –ª–æ–¥–æ–∫ "{{ category.category_name }}" –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –¢–æ–≤–∞—Ä–æ–≤: {{ total_products }}');
});
</script>

{% endblock %}