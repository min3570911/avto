{% extends "base/base.html" %}
{% block title %}–ö–∞—Ç–∞–ª–æ–≥ –∞–≤—Ç–æ–∫–æ–≤—Ä–∏–∫–æ–≤{% endblock %}
{% block start %} {% load static %} {% load category_filters %}

<style>
  .catalog-description {
    max-width: 800px;
    margin: 0 auto;
    font-size: 1.1rem;
    line-height: 1.6;
    text-align: left;
  }
  .catalog-description p {
    margin-bottom: 1rem;
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ */
  .catalog-description-block {
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    border: 1px solid #e9ecef;
    border-radius: 12px;
    padding: 25px;
    margin: 30px 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }

  .catalog-description-block h3 {
    color: #495057;
    font-size: 1.4rem;
    margin-bottom: 15px;
    font-weight: 600;
  }

  .content-info {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
    padding: 10px 15px;
    background: rgba(255,255,255,0.7);
    border-radius: 8px;
    font-size: 0.9rem;
    color: #6c757d;
  }

  .content-info span {
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .catalog-description-block.collapsed .catalog-description-text {
    max-height: 200px;
    overflow: hidden;
    position: relative;
  }

  .catalog-description-block.collapsed .read-more-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 80px;
    background: linear-gradient(transparent, rgba(248,249,250,0.95));
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding-bottom: 15px;
  }

  .toggle-description-btn {
    background: #007bff;
    color: white;
    border: none;
    padding: 8px 20px;
    border-radius: 20px;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(0,123,255,0.3);
  }

  .toggle-description-btn:hover {
    background: #0056b3;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,123,255,0.4);
  }

  .catalog-description-text {
    transition: max-height 0.3s ease;
  }

  @media (max-width: 768px) {
    .catalog-description-block.collapsed .catalog-description-text {
      max-height: 150px;
    }

    .content-info {
      flex-direction: column;
      gap: 8px;
    }
  }
</style>

<section class="section-content padding-bottom">
  <div class="mx-auto" style="max-width: 85rem; margin-top: 50px">
    <div class="container">
      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ç–∞–ª–æ–≥–∞ -->
      <div class="row">
        <div class="col-12 text-center mb-5">
          {% if catalog_description %}
            <h1 class="display-4 font-weight-bold text-primary">{{ catalog_description.title }}</h1>
          {% else %}
            <h1 class="display-4 font-weight-bold text-primary">üöó –ê–≤—Ç–æ–∫–æ–≤—Ä–∏–∫–∏</h1>
            <p class="lead text-muted">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è –≤–∞—à–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è</p>
          {% endif %}
        </div>
      </div>

      <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∞–≤—Ç–æ–∫–æ–≤—Ä–∏–∫–æ–≤ -->
      <div class="row">
        {% for category in auto_categories %}
          <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 mb-4">
            <div class="card h-100 shadow-sm hover-shadow">
              <a href="{% url 'products_by_category' category.slug %}" class="text-decoration-none text-dark">
                <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                <div class="card-img-top d-flex justify-content-center align-items-center" style="height: 200px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                  {% if category.category_image %}
                    <img src="{{ category.category_image.url }}"
                         alt="{{ category.category_name }}"
                         class="img-fluid"
                         style="max-height: 180px; max-width: 180px; object-fit: contain;">
                  {% else %}
                    <div class="text-primary" style="font-size: 4rem;">üöó</div>
                  {% endif %}
                </div>

                <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                <div class="card-body text-center">
                  <h5 class="card-title font-weight-bold">{{ category.category_name }}</h5>
                  {% if category.description %}
                    <p class="card-text text-muted small">{{ category.description|truncatewords:10 }}</p>
                  {% endif %}
                </div>
              </a>
            </div>
          </div>
        {% empty %}
          <div class="col-12 text-center">
            <div class="alert alert-info">
              <h4>üìã –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∞–≤—Ç–æ–∫–æ–≤—Ä–∏–∫–æ–≤ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</h4>
              <p>–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∫–∞—Ç–∞–ª–æ–≥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>
            </div>
          </div>
        {% endfor %}
      </div>

      <!-- –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ -->
      {% if catalog_description and catalog_description.has_content %}
        <div class="row mt-5">
          <div class="col-12">
            <div class="catalog-description-block collapsed" id="catalogDescriptionBlock">
              <h3>{{ catalog_description.title|default:"–û –∫–∞—Ç–∞–ª–æ–≥–µ –∞–≤—Ç–æ–∫–æ–≤—Ä–∏–∫–æ–≤" }}</h3>

              <div class="content-info">
                <span>üìä –ö–∞—Ç–µ–≥–æ—Ä–∏–∏: {{ auto_categories|length }}</span>
                <span>üìù –û–ø–∏—Å–∞–Ω–∏–µ: {{ catalog_description.description|striptags|truncatewords:5 }}</span>
                {% if catalog_description.additional_content %}
                  <span>üé• –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç</span>
                {% endif %}
              </div>

              <div class="catalog-description-text" id="catalogDescriptionText">
                {% if catalog_description.description %}
                  <div class="description-content">
                    {{ catalog_description.description|safe }}
                  </div>
                {% endif %}

                {% if catalog_description.additional_content %}
                  <div class="additional-content mt-4">
                    {{ catalog_description.additional_content|safe }}
                  </div>
                {% endif %}
              </div>

              <div class="read-more-overlay" id="readMoreOverlay">
                <button class="toggle-description-btn" onclick="toggleCatalogDescription()">
                  <span id="toggleText">–ß–∏—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</section>

<style>
  .hover-shadow {
    transition: all 0.3s ease;
  }

  .hover-shadow:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
  }

  .card-img-top {
    border-top-left-radius: calc(0.375rem - 1px);
    border-top-right-radius: calc(0.375rem - 1px);
  }
</style>

<script>
function toggleCatalogDescription() {
  const block = document.getElementById('catalogDescriptionBlock');
  const overlay = document.getElementById('readMoreOverlay');
  const toggleText = document.getElementById('toggleText');

  if (block.classList.contains('collapsed')) {
    // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º
    block.classList.remove('collapsed');
    toggleText.textContent = '–°–≤–µ—Ä–Ω—É—Ç—å';
  } else {
    // –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º
    block.classList.add('collapsed');
    toggleText.textContent = '–ß–∏—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é';
  }
}
</script>

{% endblock %}